<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>The Best Terraform Feature Yet? - Blog</title><meta name=Description content="Exploring the disruptive world of cloud tech"><meta property="og:title" content="The Best Terraform Feature Yet?"><meta property="og:description" content="Optional attributes for object type constraints is almost here! I&rsquo;ve been waiting for this feature to come along for a while. I have tested it extensively in -alpha, and I can confidently confirm that it is a game changer. This feature is long in the making, being discussed as far back as this thread in 2018. Today, it is now in beta, so the official release could be any day now."><meta property="og:type" content="article"><meta property="og:url" content="http://wcollins.io/posts/2022/the-best-terraform-feature-yet/the-best-terraform-feature-yet/"><meta property="og:image" content="http://wcollins.io/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-06T09:55:52-04:00"><meta property="article:modified_time" content="2022-09-06T09:55:52-04:00"><meta property="og:site_name" content="Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://wcollins.io/"><meta name=twitter:title content="The Best Terraform Feature Yet?"><meta name=twitter:description content="Optional attributes for object type constraints is almost here! I&rsquo;ve been waiting for this feature to come along for a while. I have tested it extensively in -alpha, and I can confidently confirm that it is a game changer. This feature is long in the making, being discussed as far back as this thread in 2018. Today, it is now in beta, so the official release could be any day now."><meta name=application-name content="Blog"><meta name=apple-mobile-web-app-title content="Blog"><meta name=theme-color content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><meta name=twitter:creator content="@WCollins502"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=http://wcollins.io/posts/2022/the-best-terraform-feature-yet/the-best-terraform-feature-yet/><link rel=prev href=http://wcollins.io/posts/2022/terraforming-alkira-and-fortinet-is-multicloud-bliss/><link rel=next href=http://wcollins.io/posts/2022/calculating-cost-like-a-devops-boss-with-infracost-and-aws/><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/color.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><meta name=google-site-verification content="FSCEdJZD7nAoKk16ak20hRMKNBvXlnHAU0PBBDZy5DU"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"The Best Terraform Feature Yet?","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"http://wcollins.io/posts/2022/the-best-terraform-feature-yet/the-best-terraform-feature-yet/"},"genre":"posts","keywords":"aws, awscommunitybuilders, infrastructure-as-code, terraform","wordcount":361,"url":"http://wcollins.io/posts/2022/the-best-terraform-feature-yet/the-best-terraform-feature-yet/","datePublished":"2022-09-06T09:55:52-04:00","dateModified":"2022-09-06T09:55:52-04:00","publisher":{"@type":"Organization","name":"William Collins"},"author":{"@type":"Person","name":"William Collins"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark"),window.theme=e,window.isDark=window.theme!=="light"}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else"light"==="light"||"light"==="dark"||"light"==="black"?(setTheme("light"),saveTheme("light")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")],window.switchThemeEventSet=new Set</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Blog></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/>Home </a><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/talks/>Talks </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about>About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Blog></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/ title>Home</a><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/talks/ title>Talks</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#why-it-is-useful>Why it is Useful</a></li><li><a href=#building-some-infrastructure-in-aws>Building some Infrastructure in AWS</a></li><li><a href=#test-it-yourself>Test it Yourself!</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">The Best Terraform Feature Yet?</h1><div class=post-meta><div class=post-meta-line><span class=post-author><span class="author fas fa-user-circle fa-fw"></span><a href=/ title=Author rel=author class=author>William Collins</a>
</span>&nbsp;<span class=post-category>included in </span>&nbsp;<span class=post-category>categories <a href=/categories/automation/><i class="far fa-folder fa-fw"></i>automation</a>&nbsp;<a href=/categories/cloud/><i class="far fa-folder fa-fw"></i>cloud</a>&nbsp;<a href=/categories/tools/><i class="far fa-folder fa-fw"></i>tools</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="6 September 2022">6 September 2022</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="6 September 2022">6 September 2022</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;361 words&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;2 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#why-it-is-useful>Why it is Useful</a></li><li><a href=#building-some-infrastructure-in-aws>Building some Infrastructure in AWS</a></li><li><a href=#test-it-yourself>Test it Yourself!</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></div><div class=content id=content><p><strong>Optional</strong> attributes for object type constraints is almost here! I&rsquo;ve been waiting for this feature to come along for a while. I have tested it extensively in <strong>-alpha</strong>, and I can confidently confirm that it is a <strong>game changer</strong>. This feature is long in the making, being discussed as far back as <a href=https://github.com/hashicorp/terraform/issues/19898 target=_blank rel="noopener noreferrer">this thread</a> in <strong>2018</strong>. Today, it is now in <a href=https://github.com/hashicorp/terraform/releases/tag/v1.3.0-beta1 target=_blank rel="noopener noreferrer">beta</a>, so the official release could be any day now. Let&rsquo;s demonstrate how this is useful and build some common <a href=https://registry.terraform.io/providers/hashicorp/aws/latest target=_blank rel="noopener noreferrer">AWS infrastructure</a>.</p><h2 id=why-it-is-useful class=headerLink><a href=#why-it-is-useful class=header-mark></a>Why it is Useful</h2><p>Before this feature, you could resort to using <strong>tricks</strong> to make arguments in <em>object variables</em> optional. This usually included providing a <strong>null</strong> value for optional parameters and then doing some fancy <strong>lookup</strong> or <strong>conditional</strong> like so:</p><script type=application/javascript src=https://gist.github.com/wcollins/aa7bdd03595687c78b0b0ac184df2db7.js></script><p>Now, we can make that individual attribute optional without any <em>hackery</em> involved. The first thing to know here is that when setting <strong>optional(string)</strong> without a <em>default value</em> as shown below, the <em>default value</em> is <strong>null</strong>.</p><script type=application/javascript src=https://gist.github.com/wcollins/6e1171e8dfe866030e2f4952a116d30d.js></script><p>While having the <em>default value</em> automatically set to <strong>null</strong> is helpful, it only solves half of the problem. What happens if we have a scenario where we still want to provide a value in the logic, even if one isn&rsquo;t supplied at <em>runtime</em>? Then we can set a <em>default value</em> with a second argument like this:</p><script type=application/javascript src=https://gist.github.com/wcollins/ffc407c5ce54ed3905c74112e97ed8af.js></script><h2 id=building-some-infrastructure-in-aws class=headerLink><a href=#building-some-infrastructure-in-aws class=header-mark></a>Building some Infrastructure in AWS</h2><p>This feature comes in handy when building <em>complex data types</em>. Let&rsquo;s look at something as simple as building an <strong>AWS VPC</strong>. Your organization <em>could</em> be using <a href=https://docs.aws.amazon.com/organizations/latest/userguide/services-that-can-integrate-ipam.html target=_blank rel="noopener noreferrer">VPC IPAM</a> but may still need the option to pass in <em>custom</em> CIDRs at runtime. Or, other <em>standard defaults</em> may need to be set if not provided at runtime. Take the following example:</p><script type=application/javascript src=https://gist.github.com/wcollins/e42bff6de9a5c3bed7b7ddb98c6c2264.js></script><p>If only the <em>cidr_block</em> attribute is provided at runtime, then the <em>IPAM</em> attributes will be nullified. This simplifies our resource configuration as follows:</p><script type=application/javascript src=https://gist.github.com/wcollins/edfc10c2c905d35d0a2f45f5333652c2.js></script><h2 id=test-it-yourself class=headerLink><a href=#test-it-yourself class=header-mark></a>Test it Yourself!</h2><p>Want to start testing? Grab <a href=https://github.com/hashicorp/terraform/releases/tag/v1.3.0-beta1 target=_blank rel="noopener noreferrer">v1.3.0-beta1</a> and setup your <strong>versions.tf</strong> like this:</p><script type=application/javascript src=https://gist.github.com/wcollins/2ed4c7de1ebe9b991d46ff4b86a49fb4.js></script><h2 id=conclusion class=headerLink><a href=#conclusion class=header-mark></a>Conclusion</h2><p><strong>AWS VPC</strong> is a simple example. This feature really shines when building reusable <em>infrastructure-as-code</em> for <a href="https://aws.amazon.com/network-firewall/?whats-new-cards.sort-by=item.additionalFields.postDateTime&amp;whats-new-cards.sort-order=desc" target=_blank rel="noopener noreferrer">Network Firewall</a> or even <a href=https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html target=_blank rel="noopener noreferrer">Network ACLs</a>. Anything that simplifies <strong>something</strong> and reduces or eliminates any <strong>hacks</strong> required to reach a logical outcome is super valuable. Great work finally driving this one home <a href=https://www.hashicorp.com/ target=_blank rel="noopener noreferrer">HashiCorp</a>.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 6 September 2022</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-mardown href=/posts/2022/the-best-terraform-feature-yet/the-best-terraform-feature-yet/index.md target=_blank rel="noopener noreferrer">Read markdown</a></span></div><div class=post-info-share></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/aws/>aws</a>,&nbsp;<a href=/tags/awscommunitybuilders/>awscommunitybuilders</a>,&nbsp;<a href=/tags/infrastructure-as-code/>infrastructure-as-code</a>,&nbsp;<a href=/tags/terraform/>terraform</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/2022/terraforming-alkira-and-fortinet-is-multicloud-bliss/ class=prev rel=prev title="Terraforming Alkira and Fortinet is Multicloud Bliss"><i class="fas fa-angle-left fa-fw"></i>Terraforming Alkira and Fortinet is Multicloud Bliss</a>
<a href=/posts/2022/calculating-cost-like-a-devops-boss-with-infracost-and-aws/ class=next rel=next title="Calculating Cost Like a DevOps Boss with Infracost and AWS">Calculating Cost Like a DevOps Boss with Infracost and AWS<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2019 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank rel="noopener noreferrer">William Collins</a></span></div><div class=footer-line></div><div class=footer-line></div></div></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},search:{distance:null,findAllMatches:null,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:null,ignoreLocation:null,isCaseSensitive:null,location:null,maxResultLength:10,minMatchCharLength:null,noResultsFound:"No results found",snippetLength:30,threshold:null,type:"fuse",useExtendedSearch:null}}</script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9QKVT40M3H")</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-9QKVT40M3H" async></script></div></body></html>