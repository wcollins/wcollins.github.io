<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Exploring ZeroTier For Remote Access - Blog</title><meta name=Description content="Exploring the disruptive world of cloud tech"><meta property="og:title" content="Exploring ZeroTier For Remote Access"><meta property="og:description" content="Zero Trust is all the rage lately, and traditional VPNs are getting a lot of scrutiny since they essentially add and remove encryption at the firewall. This means bad actors can skip off into the sunset (laterally) and gain access to those legacy systems with less effort. Another challenge with using a traditional VPN is scaling with the dramatic shift to hybrid work. ZeroTier is an interesting solution that claims to combine the capabilities of VPN and SD-WAN, among other things."><meta property="og:type" content="article"><meta property="og:url" content="http://wcollins.io/posts/2022/exploring-zerotier-for-remote-access/"><meta property="og:image" content="http://wcollins.io/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-10T12:15:06-04:00"><meta property="article:modified_time" content="2022-07-10T12:15:06-04:00"><meta property="og:site_name" content="Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://wcollins.io/"><meta name=twitter:title content="Exploring ZeroTier For Remote Access"><meta name=twitter:description content="Zero Trust is all the rage lately, and traditional VPNs are getting a lot of scrutiny since they essentially add and remove encryption at the firewall. This means bad actors can skip off into the sunset (laterally) and gain access to those legacy systems with less effort. Another challenge with using a traditional VPN is scaling with the dramatic shift to hybrid work. ZeroTier is an interesting solution that claims to combine the capabilities of VPN and SD-WAN, among other things."><meta name=application-name content="Blog"><meta name=apple-mobile-web-app-title content="Blog"><meta name=theme-color content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><meta name=twitter:creator content="@WCollins502"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=http://wcollins.io/posts/2022/exploring-zerotier-for-remote-access/><link rel=prev href=http://wcollins.io/posts/2022/importing-infrastructure-with-azure-terrafy/><link rel=next href=http://wcollins.io/posts/2022/aws-community-day-midwest/><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/color.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><meta name=google-site-verification content="FSCEdJZD7nAoKk16ak20hRMKNBvXlnHAU0PBBDZy5DU"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Exploring ZeroTier For Remote Access","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"http://wcollins.io/posts/2022/exploring-zerotier-for-remote-access/"},"genre":"posts","keywords":"opnsense, openvpn, tailscale, zerotier","wordcount":1157,"url":"http://wcollins.io/posts/2022/exploring-zerotier-for-remote-access/","datePublished":"2022-07-10T12:15:06-04:00","dateModified":"2022-07-10T12:15:06-04:00","publisher":{"@type":"Organization","name":"William Collins"},"author":{"@type":"Person","name":"William Collins"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark"),window.theme=e,window.isDark=window.theme!=="light"}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else"light"==="light"||"light"==="dark"||"light"==="black"?(setTheme("light"),saveTheme("light")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")],window.switchThemeEventSet=new Set</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Blog></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/>Home </a><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/talks/>Talks </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about>About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Blog></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/ title>Home</a><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/talks/ title>Talks</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#scenario>Scenario</a></li><li><a href=#first-what-is-zerotier>First, What is ZeroTier?</a><ul><li><a href=#zerotier-network-hypervisor>ZeroTier Network Hypervisor</a></li></ul></li><li><a href=#what-is-opnsense>What is OPNsense?</a></li><li><a href=#setting-up-zerotier>Setting up ZeroTier</a><ul><li><a href=#installing-zerotier-plugin>Installing ZeroTier Plugin</a></li><li><a href=#configuring-opnsense>Configuring OPNsense</a></li><li><a href=#authorizing-new-members>Authorizing New Members</a></li><li><a href=#assigning-the-zt-interface>Assigning the ZT Interface</a></li><li><a href=#adding-a-managed-route>Adding a Managed Route</a></li><li><a href=#allowing-traffic-on-opnsense>Allowing Traffic on OPNsense</a></li><li><a href=#connecting-from-client-devices>Connecting from Client Devices</a></li></ul></li><li><a href=#zerotier-sdk>ZeroTier SDK</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Exploring ZeroTier For Remote Access</h1><div class=post-meta><div class=post-meta-line><span class=post-author><span class="author fas fa-user-circle fa-fw"></span><a href=/ title=Author rel=author class=author>William Collins</a>
</span>&nbsp;<span class=post-category>included in </span>&nbsp;<span class=post-category>categories <a href=/categories/mesh-vpn/><i class="far fa-folder fa-fw"></i>mesh-vpn</a>&nbsp;<a href=/categories/remote-work/><i class="far fa-folder fa-fw"></i>remote-work</a>&nbsp;<a href=/categories/sd-wan/><i class="far fa-folder fa-fw"></i>sd-wan</a>&nbsp;<a href=/categories/vpn/><i class="far fa-folder fa-fw"></i>vpn</a>&nbsp;<a href=/categories/zero-trust/><i class="far fa-folder fa-fw"></i>zero-trust</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="10 July 2022">10 July 2022</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="10 July 2022">10 July 2022</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1157 words&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;6 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#scenario>Scenario</a></li><li><a href=#first-what-is-zerotier>First, What is ZeroTier?</a><ul><li><a href=#zerotier-network-hypervisor>ZeroTier Network Hypervisor</a></li></ul></li><li><a href=#what-is-opnsense>What is OPNsense?</a></li><li><a href=#setting-up-zerotier>Setting up ZeroTier</a><ul><li><a href=#installing-zerotier-plugin>Installing ZeroTier Plugin</a></li><li><a href=#configuring-opnsense>Configuring OPNsense</a></li><li><a href=#authorizing-new-members>Authorizing New Members</a></li><li><a href=#assigning-the-zt-interface>Assigning the ZT Interface</a></li><li><a href=#adding-a-managed-route>Adding a Managed Route</a></li><li><a href=#allowing-traffic-on-opnsense>Allowing Traffic on OPNsense</a></li><li><a href=#connecting-from-client-devices>Connecting from Client Devices</a></li></ul></li><li><a href=#zerotier-sdk>ZeroTier SDK</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></div><div class=content id=content><p><a href=https://en.wikipedia.org/wiki/Zero_trust_security_model target=_blank rel="noopener noreferrer">Zero Trust</a> is all the rage lately, and traditional VPNs are getting a lot of scrutiny since they essentially <em>add</em> and <em>remove</em> encryption at the firewall. This means <em>bad actors</em> can skip off into the sunset (laterally) and gain access to those legacy systems with less effort. Another challenge with using a traditional VPN is scaling with the dramatic shift to <em>hybrid work</em>. <a href=https://zerotier.com target=_blank rel="noopener noreferrer">ZeroTier</a> is an interesting solution that claims to combine the capabilities of <em>VPN</em> and <em>SD-WAN</em>, among other things. Let&rsquo;s take it for a spin.</p><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw"></i>How hard could Zero Trust be?<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>Most tech these days supports <em>HTTPS</em>. How hard could <em>Zero Trust</em> be? Anyone that has managed <em>certificates</em> in a large enterprise can answer this question. It is more complicated than it may appear to be on the surface. And as you begin removing that <em>complication</em>, you start trusting <em>identity providers</em> and <em>certificate authorities</em> more broadly. One question that must be asked is, if you are using any number of <em>Zero Trust</em> solutions hitting the market, are they <em>Zero Trust</em> when you trust them to own everything?</div></div></div><p><figure><a class=lightgallery href=/posts/2022/exploring-zerotier-for-remote-access/intro.png title=Intro data-thumbnail=/posts/2022/exploring-zerotier-for-remote-access/intro.png data-sub-html="<h2>Intro</h2><p>Intro</p>"><img loading=lazy src=/posts/2022/exploring-zerotier-for-remote-access/intro.png srcset="/posts/2022/exploring-zerotier-for-remote-access/intro.png, /posts/2022/exploring-zerotier-for-remote-access/intro.png 1.5x, /posts/2022/exploring-zerotier-for-remote-access/intro.png 2x" sizes=auto alt=Intro height=643 width=2700></a><figcaption class=image-caption>Intro</figcaption></figure></p><h2 id=scenario class=headerLink><a href=#scenario class=header-mark></a>Scenario</h2><p>I know many people <em>(myself included)</em> that want to access devices on their home network while they are away. A solid example here is <em>security cameras</em> or maybe a lab environment that you can test with while traveling. I wouldn&rsquo;t want to make my home cameras reachable directly from the internet.</p><p>One way you could solve this problem is by hosting an <a href=https://openvpn.net/ target=_blank rel="noopener noreferrer">OpenVPN</a> server on your network, so when you are away, you can fire up the mobile app, connect, and check out what is going on around your property. How would these scenarios work with <em>ZeroTier</em>? Let&rsquo;s lab it up!</p><h2 id=first-what-is-zerotier class=headerLink><a href=#first-what-is-zerotier class=header-mark></a>First, What is ZeroTier?</h2><p><em>ZeroTier</em> is a <em>Mesh VPN</em> solution. Mesh VPNs facilitate connectivity directly between any two endpoints in the mesh without having to transit through a concentrator in a data center. Sessions between every pair of endpoints are encrypted <em>end-to-end</em>. If a <em>bad actor</em> can exploit a device, they only gain visibility into the traffic coming in and leaving that device, making lateral movement a challenge.</p><h3 id=zerotier-network-hypervisor class=headerLink><a href=#zerotier-network-hypervisor class=header-mark></a>ZeroTier Network Hypervisor</h3><p>ZeroTier&rsquo;s <a href=https://github.com/zerotier/ZeroTierOne/tree/master/node target=_blank rel="noopener noreferrer">network hypervisor</a> is a custom protocol that implements a <a href=https://en.wikipedia.org/wiki/Virtual_Extensible_LAN target=_blank rel="noopener noreferrer">VXLAN</a> <strong>like</strong> ethernet virtualization across two layers:</p><ul><li><strong>Virtual Layer 1 (VL1)</strong>: is the underlying <em>peer-to-peer</em> transport layer handling encryption, endpoint authentication, and credential verification</li><li><strong>Virtual Layer 2 (VL2)</strong>: overlays boundaries, multicast, rule enforcement, and certificate-based access control on <em>(VL1)</em></li></ul><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw"></i>Protocol Design<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>Want to dig deeper into ZeroTier&rsquo;s <strong>Network Hypervisor</strong>? Check out the <a href=https://docs.zerotier.com/zerotier/manual target=_blank rel="noopener noreferrer">Protocol Design Whitepaper</a> for a transparent explanation of ZeroTier&rsquo;s services, apps, and libraries. Remember, sufficiently advanced technology is like magic until you read the docs!</div></div></div><h2 id=what-is-opnsense class=headerLink><a href=#what-is-opnsense class=header-mark></a>What is OPNsense?</h2><p><figure><a class=lightgallery href=/posts/2022/exploring-zerotier-for-remote-access/opnsense.png title=OPNsense data-thumbnail=/posts/2022/exploring-zerotier-for-remote-access/opnsense.png data-sub-html="<h2>OPNsense</h2><p>OPNsense</p>"><img loading=lazy src=/posts/2022/exploring-zerotier-for-remote-access/opnsense.png srcset="/posts/2022/exploring-zerotier-for-remote-access/opnsense.png, /posts/2022/exploring-zerotier-for-remote-access/opnsense.png 1.5x, /posts/2022/exploring-zerotier-for-remote-access/opnsense.png 2x" sizes=auto alt=OPNsense height=244 width=818></a><figcaption class=image-caption>OPNsense</figcaption></figure></p><p><a href=https://opnsense.org/ target=_blank rel="noopener noreferrer">OPNsense</a> is an open-source security platform based on <a href=https://www.freebsd.org/ target=_blank rel="noopener noreferrer">FreeBSD</a>. I have used it historically as an entry point into various lab environments and as a <em>customer-side</em> appliance to terminate <em>site-to-site</em> VPNs for various public cloud providers. Since the platform offers <strong>LDAP</strong> and <strong>2FA</strong>, extending access to others for collaboration is simple. OPNsense offers a <a href=https://docs.opnsense.org/manual/how-tos/zerotier.html target=_blank rel="noopener noreferrer">ZeroTier Plugin</a> and supports <em>dynamic routing</em> via <a href=https://docs.opnsense.org/manual/dynamic_routing.html target=_blank rel="noopener noreferrer">FRR</a>.</p><div class="details admonition danger open"><div class="details-summary admonition-title"><i class="icon fas fa-skull-crossbones fa-fw"></i>Why are we using a Firewall?<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>You may be asking, why are we installing this on a firewall given the <em>peer-to-peer</em> architecture of <em>ZeroTier</em>? By installing <em>ZeroTier</em> on the firewall, it acts as a bridge of sorts between all the devices on my test network and the outside <em>ZeroTier</em> members I authorize. In doing this, I don&rsquo;t have to install the <em>ZeroTier</em> client on each device I want to talk to when operating remotely.</div></div></div><h2 id=setting-up-zerotier class=headerLink><a href=#setting-up-zerotier class=header-mark></a>Setting up ZeroTier</h2><p>First, we need to sign-up for a <a href=https://zerotier.com target=_blank rel="noopener noreferrer">ZeroTier Account</a>. Each <em>VL2 network</em> is identified by a <strong>64-bit (16 hex digit)</strong> ID. Once our email is confirmed, we can create a <em>network</em>, add a new friendly name + description, and retrieve the <strong>Network ID</strong>.</p><p><figure><a class=lightgallery href=/posts/2022/exploring-zerotier-for-remote-access/zt-setup-network.gif title="ZT - Setup Network" data-thumbnail=/posts/2022/exploring-zerotier-for-remote-access/zt-setup-network.gif data-sub-html="<h2>ZT Network</h2><p>ZT - Setup Network</p>"><img loading=lazy src=/posts/2022/exploring-zerotier-for-remote-access/zt-setup-network.gif srcset="/posts/2022/exploring-zerotier-for-remote-access/zt-setup-network.gif, /posts/2022/exploring-zerotier-for-remote-access/zt-setup-network.gif 1.5x, /posts/2022/exploring-zerotier-for-remote-access/zt-setup-network.gif 2x" sizes=auto alt="ZT - Setup Network" height=1830 width=2548></a><figcaption class=image-caption>ZT Network</figcaption></figure></p><h3 id=installing-zerotier-plugin class=headerLink><a href=#installing-zerotier-plugin class=header-mark></a>Installing ZeroTier Plugin</h3><p>Next, let&rsquo;s install the <em>ZeroTier</em> plugin on the OPNsense instance in front of the <em>lab</em>.</p><p><figure><a class=lightgallery href=/posts/2022/exploring-zerotier-for-remote-access/install-zt-plugin.gif title="ZT - Install Plugin" data-thumbnail=/posts/2022/exploring-zerotier-for-remote-access/install-zt-plugin.gif data-sub-html="<h2>Plugin</h2><p>ZT - Install Plugin</p>"><img loading=lazy src=/posts/2022/exploring-zerotier-for-remote-access/install-zt-plugin.gif srcset="/posts/2022/exploring-zerotier-for-remote-access/install-zt-plugin.gif, /posts/2022/exploring-zerotier-for-remote-access/install-zt-plugin.gif 1.5x, /posts/2022/exploring-zerotier-for-remote-access/install-zt-plugin.gif 2x" sizes=auto alt="ZT - Install Plugin" height=1456 width=2836></a><figcaption class=image-caption>Plugin</figcaption></figure></p><h3 id=configuring-opnsense class=headerLink><a href=#configuring-opnsense class=header-mark></a>Configuring OPNsense</h3><p>Now, we need to configure the <em>ZeroTier</em> service on <em>OPNsense</em>. First, we must enable the service, and then we can add the <em>network</em> using the <strong>Network ID</strong> generated when we created the <em>network</em> in the <em>ZeroTier</em> portal.</p><p><figure><a class=lightgallery href=/posts/2022/exploring-zerotier-for-remote-access/configure-opnsense.gif title="Configure OPNsense" data-thumbnail=/posts/2022/exploring-zerotier-for-remote-access/configure-opnsense.gif data-sub-html="<h2>Configure OPNsense</h2><p>Configure OPNsense</p>"><img loading=lazy src=/posts/2022/exploring-zerotier-for-remote-access/configure-opnsense.gif srcset="/posts/2022/exploring-zerotier-for-remote-access/configure-opnsense.gif, /posts/2022/exploring-zerotier-for-remote-access/configure-opnsense.gif 1.5x, /posts/2022/exploring-zerotier-for-remote-access/configure-opnsense.gif 2x" sizes=auto alt="Configure OPNsense" height=1460 width=2834></a><figcaption class=image-caption>Configure OPNsense</figcaption></figure></p><h3 id=authorizing-new-members class=headerLink><a href=#authorizing-new-members class=header-mark></a>Authorizing New Members</h3><p>After we add the network in <em>OPNsense</em>, we can hop back to the <em>ZeroTier</em> portal and authorize it. Since I want to enable access for others to this lab environment, I&rsquo;ll be setting up a <em>managed route</em> with the destination as the <strong>RFC1918</strong> space of the lab with the <em>OPNsense</em> instance as the gateway. To prevent any future confusion, I configured <strong>Do Not Auto-Assign IPs</strong> when authorizing, and configured the <em>managed IP</em> statically.</p><p><figure><a class=lightgallery href=/posts/2022/exploring-zerotier-for-remote-access/authorize-member.png title="Authorize Member" data-thumbnail=/posts/2022/exploring-zerotier-for-remote-access/authorize-member.png data-sub-html="<h2>Authorize</h2><p>Authorize Member</p>"><img loading=lazy src=/posts/2022/exploring-zerotier-for-remote-access/authorize-member.png srcset="/posts/2022/exploring-zerotier-for-remote-access/authorize-member.png, /posts/2022/exploring-zerotier-for-remote-access/authorize-member.png 1.5x, /posts/2022/exploring-zerotier-for-remote-access/authorize-member.png 2x" sizes=auto alt="Authorize Member" height=941 width=2895></a><figcaption class=image-caption>Authorize</figcaption></figure></p><h3 id=assigning-the-zt-interface class=headerLink><a href=#assigning-the-zt-interface class=header-mark></a>Assigning the ZT Interface</h3><p>If you navigate to <strong>Interfaces</strong> > <strong>Assignments</strong>, you should see a new interface populated. We need to add this interface and <em>assign</em> a static <strong>IPv4</strong> address using the <em>managed IP</em> we set in the <em>ZeroTier</em> portal.</p><p><figure><a class=lightgallery href=/posts/2022/exploring-zerotier-for-remote-access/assign-interface.gif title="Assign Interface" data-thumbnail=/posts/2022/exploring-zerotier-for-remote-access/assign-interface.gif data-sub-html="<h2>Assign Interface</h2><p>Assign Interface</p>"><img loading=lazy src=/posts/2022/exploring-zerotier-for-remote-access/assign-interface.gif srcset="/posts/2022/exploring-zerotier-for-remote-access/assign-interface.gif, /posts/2022/exploring-zerotier-for-remote-access/assign-interface.gif 1.5x, /posts/2022/exploring-zerotier-for-remote-access/assign-interface.gif 2x" sizes=auto alt="Assign Interface" height=1774 width=2566></a><figcaption class=image-caption>Assign Interface</figcaption></figure></p><h3 id=adding-a-managed-route class=headerLink><a href=#adding-a-managed-route class=header-mark></a>Adding a Managed Route</h3><p>To route traffic beyond the <em>OPNsense</em> instance, we need to add a <em>managed route</em> in <em>ZeroTier</em>. For the <em>destination</em>, we will use the <strong>RFC1918</strong> space for the lab environment. For the gateway <em>(Via)</em>, we will use the <em>managed IP</em> we set for <em>OPNsense</em> in the <em>ZeroTier</em> portal.</p><p><figure><a class=lightgallery href=/posts/2022/exploring-zerotier-for-remote-access/managed-route.png title="Managed Route" data-thumbnail=/posts/2022/exploring-zerotier-for-remote-access/managed-route.png data-sub-html="<h2>Managed Routes</h2><p>Managed Route</p>"><img loading=lazy src=/posts/2022/exploring-zerotier-for-remote-access/managed-route.png srcset="/posts/2022/exploring-zerotier-for-remote-access/managed-route.png, /posts/2022/exploring-zerotier-for-remote-access/managed-route.png 1.5x, /posts/2022/exploring-zerotier-for-remote-access/managed-route.png 2x" sizes=auto alt="Managed Route" height=1487 width=2454></a><figcaption class=image-caption>Managed Routes</figcaption></figure></p><h3 id=allowing-traffic-on-opnsense class=headerLink><a href=#allowing-traffic-on-opnsense class=header-mark></a>Allowing Traffic on OPNsense</h3><p>To allow communication from other <em>ZeroTier</em> members into our lab environment, we need to add a <em>firewall rule</em> on the <em>ZeroTier</em> interface in <em>OPNsense</em>. Of course, since this is a blog, I&rsquo;m committing the <em>cardinal sin</em> of inserting an <strong>any-to-any</strong> rule. Avoid doing this as a general practice!</p><p><figure><a class=lightgallery href=/posts/2022/exploring-zerotier-for-remote-access/create-rule.gif title="Create Rule" data-thumbnail=/posts/2022/exploring-zerotier-for-remote-access/create-rule.gif data-sub-html="<h2>Rules</h2><p>Create Rule</p>"><img loading=lazy src=/posts/2022/exploring-zerotier-for-remote-access/create-rule.gif srcset="/posts/2022/exploring-zerotier-for-remote-access/create-rule.gif, /posts/2022/exploring-zerotier-for-remote-access/create-rule.gif 1.5x, /posts/2022/exploring-zerotier-for-remote-access/create-rule.gif 2x" sizes=auto alt="Create Rule" height=1804 width=2564></a><figcaption class=image-caption>Rules</figcaption></figure></p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw"></i>Without the Firewall<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content><em>ZeroTier</em> uses <a href=https://en.wikipedia.org/wiki/UDP_hole_punching target=_blank rel="noopener noreferrer">UDP hole punching</a>, which essentially tricks the router into allowing access to a port on a device directly without establishing a <em>TCP session</em>. Since firewalls are stateful, they keep track of connections. Since <em>UDP</em> doesn&rsquo;t establish a session, there is only a concept of inbound/outbound packets on the firewall. This means the firewall has to rely on limited data to let returning packets through <em>(UDP 5-tuple data)</em>.</div></div></div><h3 id=connecting-from-client-devices class=headerLink><a href=#connecting-from-client-devices class=header-mark></a>Connecting from Client Devices</h3><p>You can find the <em>ZerTier One</em> application on <a href="https://play.google.com/store/apps/details?id=com.zerotier.one&hl=en_US&gl=US" target=_blank rel="noopener noreferrer">Google Play</a> or the <a href=https://apps.apple.com/us/app/zerotier-one/id1084101492 target=_blank rel="noopener noreferrer">Apple Store</a>. Once the <em>app</em> is downloaded, you can provide the <em>network ID</em> and click <strong>Join Network</strong> to connect. Downloads for other platforms can be found <a href=https://www.zerotier.com/download/ target=_blank rel="noopener noreferrer">here.</a></p><h2 id=zerotier-sdk class=headerLink><a href=#zerotier-sdk class=header-mark></a>ZeroTier SDK</h2><p>Want to enable a mobile app to join a network without requiring special permissions on the phone or adding a <strong>tun/tap</strong> port? The <a href=https://zerotier.atlassian.net/wiki/spaces/SD/pages/569769988/ZeroTier+SDK target=_blank rel="noopener noreferrer">ZeroTier SDK</a> takes the <em>network hypervisor</em> and couples it with an embedded TCP/IP stack which you can link into an application library. This essentially moves the <em>network stack</em> into the application itself.</p><h2 id=conclusion class=headerLink><a href=#conclusion class=header-mark></a>Conclusion</h2><p><strong>Mesh VPNs</strong> offer a <em>thought-provoking</em> alternative to traditional <strong>hub-and-spoke</strong> designs. It would be interesting to see what a <em>large-scale</em> deployment would look like in the typical <em>risk-averse</em> enterprise and how the <em>migration path</em> would play out. <a href=https://tailscale.com target=_blank rel="noopener noreferrer">Tailscale</a> seems to be the biggest competitor in this space and more or less does the same thing, just using different protocols. While <em>ZeroTier&rsquo;s</em> protocol is proprietary, <em>Tailscale</em> uses <a href=https://www.wireguard.com/ target=_blank rel="noopener noreferrer">Wireguard</a> for its data plane. I look forward to seeing how <em>remote work</em> evolves over the next few years.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 10 July 2022</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-mardown href=/posts/2022/exploring-zerotier-for-remote-access/index.md target=_blank rel="noopener noreferrer">Read markdown</a></span></div><div class=post-info-share></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/opnsense/>opnsense</a>,&nbsp;<a href=/tags/openvpn/>openvpn</a>,&nbsp;<a href=/tags/tailscale/>tailscale</a>,&nbsp;<a href=/tags/zerotier/>zerotier</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/2022/importing-infrastructure-with-azure-terrafy/ class=prev rel=prev title="Importing Infrastructure With Azure Terrafy"><i class="fas fa-angle-left fa-fw"></i>Importing Infrastructure With Azure Terrafy</a>
<a href=/posts/2022/aws-community-day-midwest/ class=next rel=next title="AWS Community Day - Midwest">AWS Community Day - Midwest<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2019 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank rel="noopener noreferrer">William Collins</a></span></div><div class=footer-line></div><div class=footer-line></div></div></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},search:{distance:null,findAllMatches:null,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:null,ignoreLocation:null,isCaseSensitive:null,location:null,maxResultLength:10,minMatchCharLength:null,noResultsFound:"No results found",snippetLength:30,threshold:null,type:"fuse",useExtendedSearch:null}}</script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9QKVT40M3H")</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-9QKVT40M3H" async></script></div></body></html>