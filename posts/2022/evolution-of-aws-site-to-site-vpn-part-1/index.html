<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Evolution of AWS Site-to-Site VPN - Part 1 - Blog</title><meta name=Description content="Exploring the disruptive world of cloud tech"><meta property="og:title" content="Evolution of AWS Site-to-Site VPN - Part 1">
<meta property="og:description" content="The necessity for protocols to keep communication secure has been around since the dawn of the internet. The first ever VPN was jointly developed by a vendor consortium (which included Microsoft) in 1996, and came in the form of Point-to-Point Tunneling Protocol. Although many are skeptical about the value of VPNs in 2022 and beyond, customer consumption of cloud provider VPN services have paved the way for additional features and exponential scale."><meta property="og:type" content="article"><meta property="og:url" content="http://wcollins.io/posts/2022/evolution-of-aws-site-to-site-vpn-part-1/"><meta property="og:image" content="http://wcollins.io/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-22T08:15:58-05:00"><meta property="article:modified_time" content="2022-11-22T08:15:58-05:00"><meta property="og:site_name" content="Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://wcollins.io/"><meta name=twitter:title content="Evolution of AWS Site-to-Site VPN - Part 1"><meta name=twitter:description content="The necessity for protocols to keep communication secure has been around since the dawn of the internet. The first ever VPN was jointly developed by a vendor consortium (which included Microsoft) in 1996, and came in the form of Point-to-Point Tunneling Protocol. Although many are skeptical about the value of VPNs in 2022 and beyond, customer consumption of cloud provider VPN services have paved the way for additional features and exponential scale."><meta name=twitter:site content="@WCollins502"><meta name=application-name content="Blog"><meta name=apple-mobile-web-app-title content="Blog"><meta name=theme-color content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><meta name=twitter:creator content="@WCollins502"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=http://wcollins.io/posts/2022/evolution-of-aws-site-to-site-vpn-part-1/><link rel=prev href=http://wcollins.io/posts/2022/calculating-cost-like-a-devops-boss-with-infracost-and-aws/><link rel=next href=http://wcollins.io/posts/2022/aws-reinvent-2022-recap/><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/color.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><meta name=google-site-verification content="FSCEdJZD7nAoKk16ak20hRMKNBvXlnHAU0PBBDZy5DU"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Evolution of AWS Site-to-Site VPN - Part 1","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"http://wcollins.io/posts/2022/evolution-of-aws-site-to-site-vpn-part-1/"},"genre":"posts","keywords":"aws, awscommunitybuilders, site-to-site vpn","wordcount":613,"url":"http://wcollins.io/posts/2022/evolution-of-aws-site-to-site-vpn-part-1/","datePublished":"2022-11-22T08:15:58-05:00","dateModified":"2022-11-22T08:15:58-05:00","publisher":{"@type":"Organization","name":"William Collins"},"author":{"@type":"Person","name":"William Collins"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark"),window.theme=e,window.isDark=window.theme!=="light"}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else"light"==="light"||"light"==="dark"||"light"==="black"?(setTheme("light"),saveTheme("light")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")],window.switchThemeEventSet=new Set</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Blog></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/>Home </a><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/talks/>Talks </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about>About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Blog></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/ title>Home</a><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/talks/ title>Talks</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#my-first-experience>My First Experience</a><ul><li><a href=#making-it-highly-available>Making it Highly Available</a></li><li><a href=#growth-scale-and-operations>Growth, Scale, and Operations</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Evolution of AWS Site-to-Site VPN - Part 1</h1><div class=post-meta><div class=post-meta-line><span class=post-author><span class="author fas fa-user-circle fa-fw"></span><a href=/ title=Author rel=author class=author>William Collins</a>
</span>&nbsp;<span class=post-category>included in </span>&nbsp;<span class=post-category>categories <a href=/categories/cloud/><i class="far fa-folder fa-fw"></i>Cloud</a>&nbsp;<a href=/categories/cloud-networking/><i class="far fa-folder fa-fw"></i>Cloud-Networking</a>&nbsp;<a href=/categories/network-design/><i class="far fa-folder fa-fw"></i>Network-Design</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="22 November 2022">22 November 2022</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="22 November 2022">22 November 2022</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;613 words&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;3 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#my-first-experience>My First Experience</a><ul><li><a href=#making-it-highly-available>Making it Highly Available</a></li><li><a href=#growth-scale-and-operations>Growth, Scale, and Operations</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></div><div class=content id=content><p>The necessity for <em>protocols</em> to keep communication secure has been around since the dawn of the internet. The first ever <em>VPN</em> was jointly developed by a vendor consortium <em>(which included Microsoft)</em> in <strong><em>1996</em></strong>, and came in the form of <a href=https://en.wikipedia.org/wiki/Point-to-Point_Tunneling_Protocol target=_blank rel="noopener noreferrer">Point-to-Point Tunneling Protocol</a>. Although many are skeptical about the value of VPNs in <em>2022</em> and beyond, customer consumption of cloud provider <em>VPN</em> services have paved the way for additional features and exponential scale.</p><p>What impact do innovations like <a href=https://aws.amazon.com/transit-gateway/ target=_blank rel="noopener noreferrer">Transit Gateway</a> and <a href=https://docs.aws.amazon.com/vpn/latest/s2svpn/accelerated-vpn.html target=_blank rel="noopener noreferrer">Accelerated VPN Connections</a> have on design complexity, network performance, and operations? In this blog, I will look back at the first time I deployed a <em>site-to-site</em> VPN and then examine what is possible today when thinking through network design. This is going to be <em>two</em> parts.</p><h2 id=my-first-experience class=headerLink><a href=#my-first-experience class=header-mark></a>My First Experience</h2><p><a href=https://docs.aws.amazon.com/vpn/latest/s2svpn/VPC_VPN.html target=_blank rel="noopener noreferrer">Site-to-Site VPN</a> in AWS is a fully managed and highly available service. This comes in the form of two endpoints on the AWS side (public IP addresses in different AZs per one VPN connection). This service is charged <em>hourly</em> per connection <em>(plus data transfer charges)</em>. My first experience connecting <em>on-premises</em> to <strong>AWS</strong> looked something like this:</p><p><figure><a class=lightgallery href=/posts/2022/evolution-of-aws-site-to-site-vpn-part-1/first-vpn.png title=first-vpn data-thumbnail=/posts/2022/evolution-of-aws-site-to-site-vpn-part-1/first-vpn.png data-sub-html="<h2>First VPN</h2><p>first-vpn</p>"><img loading=lazy src=/posts/2022/evolution-of-aws-site-to-site-vpn-part-1/first-vpn.png srcset="/posts/2022/evolution-of-aws-site-to-site-vpn-part-1/first-vpn.png, /posts/2022/evolution-of-aws-site-to-site-vpn-part-1/first-vpn.png 1.5x, /posts/2022/evolution-of-aws-site-to-site-vpn-part-1/first-vpn.png 2x" sizes=auto alt=first-vpn height=1218 width=2570></a><figcaption class=image-caption>First VPN</figcaption></figure></p><p>This was long before the public cloud had disrupted enterprise infrastructure. In this case, we had a single <em>VPC</em> that required connectivity back to on-premises. Since the application being <em>developed</em> wasn&rsquo;t production, we set up a single <em>VPN</em> connection to a single physical router in the Data Center. This was easy work since, as <em>network engineers</em>, we pushed <em>VPNs</em> like <em>weights</em>. And we had an existing <em>B2B</em> process in place, so our paperwork + process was ready. Somewhere along the way, though, this application went into production.</p><h3 id=making-it-highly-available class=headerLink><a href=#making-it-highly-available class=header-mark></a>Making it Highly Available</h3><p>Pre <em>Transit Gateway</em>, you would typically see a Virtual Private Gateway and VPN connection from each <em>VPC</em> back to <em>on-premises</em> devices. If you follow best practices and want the highest availability possible in this scenario, you will also have redundant devices on-premises. This means you would end up with <strong>2x VPN connections</strong>, which totals <strong>4x VPN tunnels</strong> per VPC. Once the application went past <em>QA</em>, to meet our requirements for <em>Tier 0</em> infrastructure, we needed <em>high availability</em>.</p><p><figure><a class=lightgallery href=/posts/2022/evolution-of-aws-site-to-site-vpn-part-1/single-vpc.png title=single-vpc data-thumbnail=/posts/2022/evolution-of-aws-site-to-site-vpn-part-1/single-vpc.png data-sub-html="<h2>Single VPC</h2><p>single-vpc</p>"><img loading=lazy src=/posts/2022/evolution-of-aws-site-to-site-vpn-part-1/single-vpc.png srcset="/posts/2022/evolution-of-aws-site-to-site-vpn-part-1/single-vpc.png, /posts/2022/evolution-of-aws-site-to-site-vpn-part-1/single-vpc.png 1.5x, /posts/2022/evolution-of-aws-site-to-site-vpn-part-1/single-vpc.png 2x" sizes=auto alt=single-vpc height=1598 width=2534></a><figcaption class=image-caption>Single VPC</figcaption></figure></p><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw"></i>Traffic Forwarding<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>One question I could always count on getting from <em>developers</em> when we would onboard this design was: &ldquo;Since we have four tunnels here, why can&rsquo;t we forward traffic on all of them?&rdquo; The simple answer is that you can override defaults and forward traffic across all tunnels <strong>to AWS</strong> from on-premises; however, the VGW will always select a single tunnel for return traffic.</div></div></div><h3 id=growth-scale-and-operations class=headerLink><a href=#growth-scale-and-operations class=header-mark></a>Growth, Scale, and Operations</h3><p>At some point, <strong>Digital Transformation</strong> <em>(you may have heard of it)</em> caused crazy fast growth. And with that growth came more VPCs. And with those VPCs came the necessity for connectivity back to on-premises. Say we add just two additional VPCs using the above methodology, and we end up with <strong>6x VPN connections</strong>, bringing us to <strong>12x VPN tunnels</strong> to manage.</p><p><figure><a class=lightgallery href=/posts/2022/evolution-of-aws-site-to-site-vpn-part-1/multi-vpc.gif title=multi-vpc data-thumbnail=/posts/2022/evolution-of-aws-site-to-site-vpn-part-1/multi-vpc.gif data-sub-html="<h2>Multi VPC</h2><p>multi-vpc</p>"><img loading=lazy src=/posts/2022/evolution-of-aws-site-to-site-vpn-part-1/multi-vpc.gif srcset="/posts/2022/evolution-of-aws-site-to-site-vpn-part-1/multi-vpc.gif, /posts/2022/evolution-of-aws-site-to-site-vpn-part-1/multi-vpc.gif 1.5x, /posts/2022/evolution-of-aws-site-to-site-vpn-part-1/multi-vpc.gif 2x" sizes=auto alt=multi-vpc height=1136 width=1762></a><figcaption class=image-caption>Multi VPC</figcaption></figure></p><div class="details admonition danger open"><div class="details-summary admonition-title"><i class="icon fas fa-skull-crossbones fa-fw"></i>How much growth?<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>The above example is <strong>single region</strong> with only <strong>3 VPCs</strong>. The reality for many organizations using <em>AWS</em> is much larger. What would this design look like if we had <strong>50 VPCs</strong>? What happens when we need to include <em>multi-region</em> for DR capabilities? How does it impact operations when an application has performance issues, and the network is getting blamed?</div></div></div><h2 id=conclusion class=headerLink><a href=#conclusion class=header-mark></a>Conclusion</h2><p>As we onboard more <em>VPCs</em>, it becomes apparent that the above design does not easily scale. Bandwidth is limited, tunnels increase exponentially, and operations will have limited success in diagnosing network problems <em>(or proving the network is not the problem)</em>. In <em>Part 2</em> we will dive into how <a href=https://aws.amazon.com/about-aws/whats-new/2018/11/introducing-aws-transit-gateway/ target=_blank rel="noopener noreferrer">Transit Gateway</a> and <a href=https://docs.aws.amazon.com/vpn/latest/s2svpn/accelerated-vpn.html target=_blank rel="noopener noreferrer">Accelerated VPN Connections</a> take this from an operational <em>misstep</em> to an enterprise <em>success story</em>.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 22 November 2022</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-mardown href=/posts/2022/evolution-of-aws-site-to-site-vpn-part-1/index.md target=_blank rel="noopener noreferrer">Read markdown</a></span></div><div class=post-info-share></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/aws/>Aws</a>,&nbsp;<a href=/tags/awscommunitybuilders/>Awscommunitybuilders</a>,&nbsp;<a href=/tags/site-to-site-vpn/>Site-to-Site Vpn</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/2022/calculating-cost-like-a-devops-boss-with-infracost-and-aws/ class=prev rel=prev title="Calculating Cost Like a DevOps Boss with Infracost and AWS"><i class="fas fa-angle-left fa-fw"></i>Calculating Cost Like a DevOps Boss with Infracost and AWS</a>
<a href=/posts/2022/aws-reinvent-2022-recap/ class=next rel=next title="AWS re:Invent 2022 - Recap">AWS re:Invent 2022 - Recap<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2019 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank rel="noopener noreferrer">William Collins</a></span></div><div class=footer-line></div><div class=footer-line></div></div></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},search:{distance:null,findAllMatches:null,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:null,ignoreLocation:null,isCaseSensitive:null,location:null,maxResultLength:10,minMatchCharLength:null,noResultsFound:"No results found",snippetLength:30,threshold:null,type:"fuse",useExtendedSearch:null}}</script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9QKVT40M3H")</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-9QKVT40M3H" async></script></div></body></html>