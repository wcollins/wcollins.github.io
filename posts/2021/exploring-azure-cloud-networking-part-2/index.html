<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Exploring Azure Cloud Networking - (Part 2) - Blog</title><meta name=Description content="Exploring the disruptive world of cloud tech"><meta property="og:title" content="Exploring Azure Cloud Networking - (Part 2)"><meta property="og:description" content="In Part 1, we went over some fundamentals. For Part 2, we will examine Azure network design patterns based on cloud maturity and organization size. The concept of design patterns was first introduced by Christopher Alexander and has profoundly influenced many technical disciplines.
To keep things simple, let&rsquo;s define a design pattern as a reusable solution to a commonly occurring problem. Of course, you are not the first practitioner out there transitioning to cloud or growing to a new maturity model."><meta property="og:type" content="article"><meta property="og:url" content="http://wcollins.io/posts/2021/exploring-azure-cloud-networking-part-2/"><meta property="og:image" content="http://wcollins.io/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-04-28T13:11:59-04:00"><meta property="article:modified_time" content="2021-04-28T13:11:59-04:00"><meta property="og:site_name" content="Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://wcollins.io/"><meta name=twitter:title content="Exploring Azure Cloud Networking - (Part 2)"><meta name=twitter:description content="In Part 1, we went over some fundamentals. For Part 2, we will examine Azure network design patterns based on cloud maturity and organization size. The concept of design patterns was first introduced by Christopher Alexander and has profoundly influenced many technical disciplines.
To keep things simple, let&rsquo;s define a design pattern as a reusable solution to a commonly occurring problem. Of course, you are not the first practitioner out there transitioning to cloud or growing to a new maturity model."><meta name=application-name content="Blog"><meta name=apple-mobile-web-app-title content="Blog"><meta name=theme-color content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><meta name=twitter:creator content="@WCollins502"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=http://wcollins.io/posts/2021/exploring-azure-cloud-networking-part-2/><link rel=prev href=http://wcollins.io/posts/2021/exploring-azure-cloud-networking-part-1/><link rel=next href=http://wcollins.io/posts/2021/understanding-the-world-of-bitcoin/><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/color.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><meta name=google-site-verification content="FSCEdJZD7nAoKk16ak20hRMKNBvXlnHAU0PBBDZy5DU"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Exploring Azure Cloud Networking - (Part 2)","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"http://wcollins.io/posts/2021/exploring-azure-cloud-networking-part-2/"},"genre":"posts","keywords":"azure, bgp, cloud routing, expressroute, hybrid cloud, private peering","wordcount":1670,"url":"http://wcollins.io/posts/2021/exploring-azure-cloud-networking-part-2/","datePublished":"2021-04-28T13:11:59-04:00","dateModified":"2021-04-28T13:11:59-04:00","publisher":{"@type":"Organization","name":"William Collins"},"author":{"@type":"Person","name":"William Collins"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark"),window.theme=e,window.isDark=window.theme!=="light"}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else"light"==="light"||"light"==="dark"||"light"==="black"?(setTheme("light"),saveTheme("light")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")],window.switchThemeEventSet=new Set</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Blog></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/>Home </a><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/talks/>Talks </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about>About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Blog></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/ title>Home</a><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/talks/ title>Talks</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#patterns-overview>Patterns Overview</a><ul><li><a href=#cloud-adoption-framework-caf>Cloud Adoption Framework (CAF)</a></li></ul></li><li><a href=#the-island>The Island</a><ul><li><a href=#island-1---first-pass>Island #1 - First Pass</a></li><li><a href=#island-2---cloud-native>Island #2 - Cloud Native</a></li></ul></li><li><a href=#hybrid>Hybrid</a><ul><li><a href=#hybrid-1---forced-tunneling>Hybrid #1 - Forced Tunneling</a></li><li><a href=#hybrid-2---cloud-dmz>Hybrid #2 - Cloud DMZ</a></li></ul></li><li><a href=#hub--spoke>Hub & Spoke</a><ul><li><a href=#centralized-hub>Centralized Hub</a></li><li><a href=#spoke-to-spoke-routing>Spoke-To-Spoke Routing</a><ul><li><a href=#on-premises--colo---routing>On-Premises / CoLo - Routing</a></li><li><a href=#network-virtual-appliance-nva---routing>Network Virtual Appliance (NVA) - Routing</a></li></ul></li></ul></li><li><a href=#conclusion>Conclusion</a><ul><li><a href=#acknowledgements>Acknowledgements</a></li></ul></li></ul></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Exploring Azure Cloud Networking - (Part 2)</h1><div class=post-meta><div class=post-meta-line><span class=post-author><span class="author fas fa-user-circle fa-fw"></span><a href=/ title=Author rel=author class=author>William Collins</a>
</span>&nbsp;<span class=post-category>included in </span>&nbsp;<span class=post-category>categories <a href=/categories/cloud/><i class="far fa-folder fa-fw"></i>cloud</a>&nbsp;<a href=/categories/cloud-architecture/><i class="far fa-folder fa-fw"></i>cloud architecture</a>&nbsp;<a href=/categories/cloud-networking/><i class="far fa-folder fa-fw"></i>cloud networking</a>&nbsp;<a href=/categories/design-patterns/><i class="far fa-folder fa-fw"></i>design patterns</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="28 April 2021">28 April 2021</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="28 April 2021">28 April 2021</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1670 words&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;8 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#patterns-overview>Patterns Overview</a><ul><li><a href=#cloud-adoption-framework-caf>Cloud Adoption Framework (CAF)</a></li></ul></li><li><a href=#the-island>The Island</a><ul><li><a href=#island-1---first-pass>Island #1 - First Pass</a></li><li><a href=#island-2---cloud-native>Island #2 - Cloud Native</a></li></ul></li><li><a href=#hybrid>Hybrid</a><ul><li><a href=#hybrid-1---forced-tunneling>Hybrid #1 - Forced Tunneling</a></li><li><a href=#hybrid-2---cloud-dmz>Hybrid #2 - Cloud DMZ</a></li></ul></li><li><a href=#hub--spoke>Hub & Spoke</a><ul><li><a href=#centralized-hub>Centralized Hub</a></li><li><a href=#spoke-to-spoke-routing>Spoke-To-Spoke Routing</a><ul><li><a href=#on-premises--colo---routing>On-Premises / CoLo - Routing</a></li><li><a href=#network-virtual-appliance-nva---routing>Network Virtual Appliance (NVA) - Routing</a></li></ul></li></ul></li><li><a href=#conclusion>Conclusion</a><ul><li><a href=#acknowledgements>Acknowledgements</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>In <a href=https://wcollins.io/posts/2021/exploring-azure-cloud-networking-part-1/ target=_blank rel="noopener noreferrer">Part 1</a>, we went over some fundamentals. For <em>Part 2</em>, we will examine <a href=https://azure.microsoft.com/en-us/ target=_blank rel="noopener noreferrer">Azure</a> network design patterns based on <em>cloud maturity</em> and <em>organization size</em>. The concept of <a href=https://en.wikipedia.org/wiki/Design_pattern target=_blank rel="noopener noreferrer">design patterns</a> was first introduced by <a href=https://en.wikipedia.org/wiki/Christopher_Alexander target=_blank rel="noopener noreferrer">Christopher Alexander</a> and has profoundly influenced many <em>technical disciplines</em>.</p><p>To keep things simple, let&rsquo;s define a <em>design pattern</em> as a <strong>reusable solution to a commonly occurring problem</strong>. Of course, you are not the first practitioner out there transitioning to <em>cloud</em> or growing to a new maturity model. Many trailblazers have already walked the walk and left behind beautiful <em>blueprints</em> to help you along the way.</p><h2 id=patterns-overview class=headerLink><a href=#patterns-overview class=header-mark></a>Patterns Overview</h2><p>While every scenario may not fall under these categories, there are generally three <em>phases</em> that your cloud network may likely go through as your organization matures.</p><ul><li><strong>Island</strong> - Starting point or <em>cloud native</em> panacea; Disconnected from the enterprise network</li><li><strong>Hybrid</strong> - Often inevitable (integration requirements); Connected to the enterprise network</li><li><strong>Hub & Spoke</strong> - Stemmed by growth and need for centralized control; Increased governance</li></ul><h3 id=cloud-adoption-framework-caf class=headerLink><a href=#cloud-adoption-framework-caf class=header-mark></a>Cloud Adoption Framework (CAF)</h3><p>The <a href=https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/enterprise-scale/network-topology-and-connectivity target=_blank rel="noopener noreferrer"><strong>Cloud Adoption Framework (CAF)</strong></a> has been crafted using essential feedback from partners and customers. This provides an excellent place to start as you begin planning. Of course, you don&rsquo;t just land on the ideal design, but it helps to have a clear picture of where you are going.</p><p><figure><a class=lightgallery href=/posts/2021/exploring-azure-cloud-networking-part-2/azure-caf.png title="Azure - Cloud Adoption Framework" data-thumbnail=/posts/2021/exploring-azure-cloud-networking-part-2/azure-caf.png data-sub-html="<h2>CAF</h2><p>Azure - Cloud Adoption Framework</p>"><img loading=lazy src=/posts/2021/exploring-azure-cloud-networking-part-2/azure-caf.png srcset="/posts/2021/exploring-azure-cloud-networking-part-2/azure-caf.png, /posts/2021/exploring-azure-cloud-networking-part-2/azure-caf.png 1.5x, /posts/2021/exploring-azure-cloud-networking-part-2/azure-caf.png 2x" sizes=auto alt="Azure - Cloud Adoption Framework" height=1770 width=2942></a><figcaption class=image-caption>CAF</figcaption></figure></p><blockquote><p>The Microsoft <a href=https://github.com/mspnp target=_blank rel="noopener noreferrer"><strong>Patterns & Practices</strong></a> site is another good <em>Azure</em> specific resource for understanding proven patterns and reference architectures.</p></blockquote><h2 id=the-island class=headerLink><a href=#the-island class=header-mark></a>The Island</h2><p><a href=https://www.merriam-webster.com/dictionary/island target=_blank rel="noopener noreferrer">Webster</a> defines <em>island</em> as <strong>":an isolated group or area"</strong>. There are a few variations of <strong>The Island</strong>, but one thing remains consistent; It has no connectivity to <em>on-premises</em> networks. This environment is completely isolated.</p><h3 id=island-1---first-pass class=headerLink><a href=#island-1---first-pass class=header-mark></a>Island #1 - First Pass</h3><p>Every good story has a beginning. Many enterprises started their cloud journey many years back by simply setting up an account, doing some sandboxing, and just familiarizing themselves with the Cloud. You never know, one day that <em>sandbox</em> application could turn <em>Production</em> overnight! (Yes, I&rsquo;ve seen this happen)</p><p>Usually, the <strong>first pass</strong> at a technology (especially as transformative as Cloud) isn&rsquo;t going to be perfect. There are a lot of things you don&rsquo;t know until you know. The main criteria that define our <em>first pass</em> at Cloud may include:</p><ul><li>Single <a href=https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview target=_blank rel="noopener noreferrer">Virtual Network</a>; All dependencies <em>self-contained</em></li><li>Enterprise <strong>Apps and Data</strong> live in Data Centers (Owned or Colocation)</li><li>No connectivity to <em>on-premises</em> networks; Environment is completely isolated</li><li>Cloud Environment may not be under <em>centralized I.T.</em> control; They slow things down, right?</li></ul><p><figure><a class=lightgallery href=/posts/2021/exploring-azure-cloud-networking-part-2/island-first-pass.png title="Island - First Pass" data-thumbnail=/posts/2021/exploring-azure-cloud-networking-part-2/island-first-pass.png data-sub-html="<h2>Island</h2><p>Island - First Pass</p>"><img loading=lazy src=/posts/2021/exploring-azure-cloud-networking-part-2/island-first-pass.png srcset="/posts/2021/exploring-azure-cloud-networking-part-2/island-first-pass.png, /posts/2021/exploring-azure-cloud-networking-part-2/island-first-pass.png 1.5x, /posts/2021/exploring-azure-cloud-networking-part-2/island-first-pass.png 2x" sizes=auto alt="Island - First Pass" height=2027 width=1914></a><figcaption class=image-caption>Island</figcaption></figure></p><h3 id=island-2---cloud-native class=headerLink><a href=#island-2---cloud-native class=header-mark></a>Island #2 - Cloud Native</h3><p>We are getting this whole <em>cloud computing</em> thing down now. We are super mature around <em>security</em> and <em>governance</em>, and we want to take full advantage of Azure-specific services. In this scenario, we don&rsquo;t have any <em>hybrid</em> dependencies and focus on reliable and scalable infrastructure leveraging <em>cloud native</em> constructs in a single cloud-only. As a set of outcomes, this pattern aims to:</p><ul><li><a href="https://www.section.io/blog/scaling-horizontally-vs-vertically/#:~:text=Horizontal%20scaling%20means%20scaling%20by,as%20%E2%80%9Cscaling%20up%E2%80%9D" target=_blank rel="noopener noreferrer"><strong>Scale Out</strong></a>.and not up; Optimize based on consumption</li><li><a href=https://acloudguru.com/blog/engineering/why-and-how-do-we-build-a-multi-region-active-active-architecture target=_blank rel="noopener noreferrer"><strong>Multi-Region</strong></a> <em>Active-Active</em> design; Non-blocking asynchronous communication</li><li>Embrace <a href=https://blog.dreamfactory.com/stateful-vs-stateless-web-app-design/ target=_blank rel="noopener noreferrer"><strong>Stateless Application Design</strong></a>; Local state is considered an anti-pattern</li><li>Use <strong>Internet</strong> as primary transport; State is shared between regions over <em>cloud backbone</em></li></ul><p><figure><a class=lightgallery href=/posts/2021/exploring-azure-cloud-networking-part-2/island-cloud-native.png title="Island - Cloud Native" data-thumbnail=/posts/2021/exploring-azure-cloud-networking-part-2/island-cloud-native.png data-sub-html="<h2>Island - Cloud Native</h2><p>Island - Cloud Native</p>"><img loading=lazy src=/posts/2021/exploring-azure-cloud-networking-part-2/island-cloud-native.png srcset="/posts/2021/exploring-azure-cloud-networking-part-2/island-cloud-native.png, /posts/2021/exploring-azure-cloud-networking-part-2/island-cloud-native.png 1.5x, /posts/2021/exploring-azure-cloud-networking-part-2/island-cloud-native.png 2x" sizes=auto alt="Island - Cloud Native" height=2284 width=3176></a><figcaption class=image-caption>Island - Cloud Native</figcaption></figure></p><blockquote><p>Our Cloud-Native Island is a <em>best case scenario</em>, but also unlikely at first for the traditional enterprise. This takes into account that your data lives in the Cloud, and you aren&rsquo;t making any calls to backend services in your data centers. <a href="https://whatis.techtarget.com/definition/data-gravity#:~:text=Data%20gravity%20is%20the%20ability,%28the%20amount%20of%20data%29." target=_blank rel="noopener noreferrer">Data Gravity</a> has proven to be a worthy antagonist in the quest to <em>cloud native</em>.</p></blockquote><h2 id=hybrid class=headerLink><a href=#hybrid class=header-mark></a>Hybrid</h2><p>Firstly, my definition of <em>Hybrid Cloud</em> is: <strong>Any workload that combines <em>public cloud</em> with an <em>on-premises</em> data center environment</strong>. Meaning, if for some reason, this public Cloud no longer has connectivity back to the data center, then the application(s) will not work.</p><p>At some point, that Island is going to get a little lonely. How can you possibly migrate anything without a reliable connection to Azure? I will forego the <em>whiplash</em> that generally takes place at this point in the story. That beautiful moment we all remember when <strong>server, network, and security</strong> experts first get involved.</p><p>So, we need a little bit of <em>hybrid</em> now. This is probably where things get the most complicated. There are many variations of <em>hybrid</em>, a plethora of options/considerations, and numerous maturity levels.</p><h3 id=hybrid-1---forced-tunneling class=headerLink><a href=#hybrid-1---forced-tunneling class=header-mark></a>Hybrid #1 - Forced Tunneling</h3><p>Our first iteration of <em>hybrid</em> is met with much <em>skepticism</em> and minimal <em>trust</em>. This is why the obvious thing to do from the <strong>network and security</strong> space is to backhaul every packet to the data center to use existing routing, segmentation, deep packet inspection, file blocking, etc.</p><p>This practice is known as <a href=https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-forced-tunneling-rm target=_blank rel="noopener noreferrer">Forced Tunneling</a>. It does precisely what is implied, e.g., it enables redirection of all traffic destined to the Internet back to your <em>on-premises</em> network.</p><ul><li>To accomplish this with <a href=https://docs.microsoft.com/en-us/azure/expressroute/expressroute-circuit-peerings#privatepeering target=_blank rel="noopener noreferrer">ExpressRoute - Private Peering</a>, advertise a default route from your <em>BGP speaker</em> and all traffic from the associated <em>virtual network</em> will be routed to your <em>on-premises</em> network.</li><li>Doing this will force traffic from services offered by Microsoft like <a href=https://azure.microsoft.com/en-us/services/storage/ target=_blank rel="noopener noreferrer">Azure Storage</a> back on-premises as well; You will have to account for return traffic via <a href=https://docs.microsoft.com/en-us/azure/expressroute/expressroute-circuit-peerings#microsoftpeering target=_blank rel="noopener noreferrer">Microsoft Peering</a> or the public Internet.</li><li>If <a href=https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-service-endpoints-overview target=_blank rel="noopener noreferrer">Service Endpoints</a> is configured, traffic is not forced on-premises and remains on Azure&rsquo;s backbone network.</li></ul><blockquote><p>To accomplish <em>Forced Tunneling</em> over a <a href=https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-howto-site-to-site-classic-portal target=_blank rel="noopener noreferrer">Site-to-Site VPN</a>, you would set up a <a href=https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-udr-overview#user-defined target=_blank rel="noopener noreferrer">User Defined Route</a> to set the default route to the <a href=https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways target=_blank rel="noopener noreferrer">Azure VPN Gateway</a>.</p></blockquote><p><figure><a class=lightgallery href=/posts/2021/exploring-azure-cloud-networking-part-2/hybrid-forced-tunneling.png title="Hybrid - Forced Tunneling" data-thumbnail=/posts/2021/exploring-azure-cloud-networking-part-2/hybrid-forced-tunneling.png data-sub-html="<h2>Forced Tunneling</h2><p>Hybrid - Forced Tunneling</p>"><img loading=lazy src=/posts/2021/exploring-azure-cloud-networking-part-2/hybrid-forced-tunneling.png srcset="/posts/2021/exploring-azure-cloud-networking-part-2/hybrid-forced-tunneling.png, /posts/2021/exploring-azure-cloud-networking-part-2/hybrid-forced-tunneling.png 1.5x, /posts/2021/exploring-azure-cloud-networking-part-2/hybrid-forced-tunneling.png 2x" sizes=auto alt="Hybrid - Forced Tunneling" height=2282 width=1901></a><figcaption class=image-caption>Forced Tunneling</figcaption></figure></p><h3 id=hybrid-2---cloud-dmz class=headerLink><a href=#hybrid-2---cloud-dmz class=header-mark></a>Hybrid #2 - Cloud DMZ</h3><p>For workloads in the Cloud, it makes sense to reduce dependencies on-premises (especially Internet) and keep as much traffic as we can in Azure. Also, to continue meeting various <strong>security requirements</strong>, often deploying <a href=https://azure.microsoft.com/en-us/blog/best-practices-to-consider-before-deploying-a-network-virtual-appliance/ target=_blank rel="noopener noreferrer">Network Virtual Appliances (NVAs)</a> will be necessary.</p><p>A common practice that accommodates future growth is routing <strong>egress and ingress</strong> traffic through separate <a href=https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/overview target=_blank rel="noopener noreferrer">scale sets</a>. You can then use <a href=https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-udr-overview#user-defined target=_blank rel="noopener noreferrer">User Defined Routes</a> for limited traffic engineering. For example, traffic destined to the Internet would use the <em>private IP address</em> of an <a href=https://docs.microsoft.com/en-us/azure/load-balancer/components#frontend-ip-configurations target=_blank rel="noopener noreferrer">internal load balancer</a> as the <em>next-hop</em>.</p><p>In this scenario, <strong>Ingress</strong> represents <em>inbound</em> connections into the <a href=https://en.wikipedia.org/wiki/DMZ_%28computing%29 target=_blank rel="noopener noreferrer">DMZ</a> while <strong>Egress</strong> represents traffic <em>destined</em> to the internet. Another benefit of this design is additional throughput. <a href=https://docs.paloaltonetworks.com/vm-series/10-0/vm-series-performance-capacity/vm-series-performance-capacity/vm-series-on-azure-performance-and-capacity.html target=_blank rel="noopener noreferrer">VM-Series - Firewalls</a> have come a long way but still have limitations that you must consider. You might also consider deploying an additional <em>scale set</em> for <strong>Transitive</strong> routing in substantial deployments.</p><p><figure><a class=lightgallery href=/posts/2021/exploring-azure-cloud-networking-part-2/hybrid-cloud-dmz.png title="Hybrid - Cloud DMZ" data-thumbnail=/posts/2021/exploring-azure-cloud-networking-part-2/hybrid-cloud-dmz.png data-sub-html="<h2>Cloud DMZ</h2><p>Hybrid - Cloud DMZ</p>"><img loading=lazy src=/posts/2021/exploring-azure-cloud-networking-part-2/hybrid-cloud-dmz.png srcset="/posts/2021/exploring-azure-cloud-networking-part-2/hybrid-cloud-dmz.png, /posts/2021/exploring-azure-cloud-networking-part-2/hybrid-cloud-dmz.png 1.5x, /posts/2021/exploring-azure-cloud-networking-part-2/hybrid-cloud-dmz.png 2x" sizes=auto alt="Hybrid - Cloud DMZ" height=2299 width=2751></a><figcaption class=image-caption>Cloud DMZ</figcaption></figure></p><blockquote><p>NVAs must be deployed in <em>self-contained</em> subnets. Deploying an appliance in the same subnet as your <em>workloads</em> and attaching a UDR to that same subnet may cause a routing loop.</p></blockquote><h2 id=hub--spoke class=headerLink><a href=#hub--spoke class=header-mark></a>Hub & Spoke</h2><p>Until now, our patterns have been simple; Only a single <em>virtual network</em> has been referenced. In larger enterprises, this can get a little tricky. Over time as the Cloud grows, additional business units, centralized services, security, and even finance may start to leverage the Cloud. Sound <a href=https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/govern/methodology target=_blank rel="noopener noreferrer">governance</a> is critical in managing adoption.</p><p>As consumption increases, <a href=https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/decision-guides/subscriptions/ target=_blank rel="noopener noreferrer">subscriptions</a> will likely grow. It is generally a good practice to model these constructs to match your organization&rsquo;s hierarchy. As you follow this path, other <em>virtual networks</em> will be created. How is this challenge designed around while taking <em>scale and governance</em> in mind?</p><h3 id=centralized-hub class=headerLink><a href=#centralized-hub class=header-mark></a>Centralized Hub</h3><p>Network practitioners are going to be very familiar with <em>Hub & Spoke</em>. Think about it like data center and branch office routing. We don&rsquo;t want prefixes to be visible randomly all across the network. Aggregation is our friend here.</p><p>It is much more efficient to have summarization of routing for each site at the edge. It also makes sense to centralize certain services at the edge rather than deploy them at every office. Deploying <a href=https://www.paloaltonetworks.com/network-security/next-generation-firewall target=_blank rel="noopener noreferrer">NGFWs</a> at every site would become expensive and challenging to manage. Our cloud hub will follow this same pattern. Any shared services that will be used across all <em>spokes</em> will live here.</p><p><figure><a class=lightgallery href=/posts/2021/exploring-azure-cloud-networking-part-2/hub-spoke-overview.png title="Hub &amp;amp; Spoke - Overview" data-thumbnail=/posts/2021/exploring-azure-cloud-networking-part-2/hub-spoke-overview.png data-sub-html="<h2>Hub & Spoke</h2><p>Hub &amp;amp; Spoke - Overview</p>"><img loading=lazy src=/posts/2021/exploring-azure-cloud-networking-part-2/hub-spoke-overview.png srcset="/posts/2021/exploring-azure-cloud-networking-part-2/hub-spoke-overview.png, /posts/2021/exploring-azure-cloud-networking-part-2/hub-spoke-overview.png 1.5x, /posts/2021/exploring-azure-cloud-networking-part-2/hub-spoke-overview.png 2x" sizes=auto alt="Hub &amp;amp; Spoke - Overview" height=2158 width=2406></a><figcaption class=image-caption>Hub & Spoke</figcaption></figure></p><h3 id=spoke-to-spoke-routing class=headerLink><a href=#spoke-to-spoke-routing class=header-mark></a>Spoke-To-Spoke Routing</h3><p>Now that multiple <em>virtual networks</em> are in play, how does traffic flow? Remember from <a href=https://wcollins.io/posts/2021/exploring-azure-cloud-networking-part-1/#virtual-network-peering target=_blank rel="noopener noreferrer">Part 1</a> that VNets are <em>non-transitive</em>. For example, let&rsquo;s say we have <em>Spoke-A</em> and <em>Spoke-B</em> which are <a href=https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-manage-peering target=_blank rel="noopener noreferrer">VNet peered</a> back to our hub. There have been two common approaches to solving this in the past:</p><h4 id=on-premises--colo---routing class=headerLink><a href=#on-premises--colo---routing class=header-mark></a>On-Premises / CoLo - Routing</h4><p>This approach forwards traffic back to a physical device (That lives outside of Azure&rsquo;s Cloud) that knows how to route packets. This approach is usually the first iteration as, if you already have <em>hybrid</em> connectivity, then these devices are already reachable.</p><ul><li>The Hub <em>virtual network</em> is configured to <strong>allow gateway transit</strong>; This enables peered <em>virtual networks</em> to use any attached <em>virtual network gateways</em></li><li>Each <em>spoke</em> should be configured to <strong>use remote gateways</strong>; This is required for traffic to use a gateway living in the <em>virtual network</em> you are peered with</li><li>The router <em>on-premises</em> will handle any <em>spoke-to-spoke</em> routing; The existing <a href=https://en.wikipedia.org/wiki/Border_Gateway_Protocol target=_blank rel="noopener noreferrer">BGP</a> which was set up for <em>private peering</em> handles <em>dynamic routing</em></li></ul><p><figure><a class=lightgallery href=/posts/2021/exploring-azure-cloud-networking-part-2/transit-routing-1.png title="Transit Routing - Option 1" data-thumbnail=/posts/2021/exploring-azure-cloud-networking-part-2/transit-routing-1.png data-sub-html="<h2>Transit Routing - 1</h2><p>Transit Routing - Option 1</p>"><img loading=lazy src=/posts/2021/exploring-azure-cloud-networking-part-2/transit-routing-1.png srcset="/posts/2021/exploring-azure-cloud-networking-part-2/transit-routing-1.png, /posts/2021/exploring-azure-cloud-networking-part-2/transit-routing-1.png 1.5x, /posts/2021/exploring-azure-cloud-networking-part-2/transit-routing-1.png 2x" sizes=auto alt="Transit Routing - Option 1" height=1326 width=2719></a><figcaption class=image-caption>Transit Routing - 1</figcaption></figure></p><h4 id=network-virtual-appliance-nva---routing class=headerLink><a href=#network-virtual-appliance-nva---routing class=header-mark></a>Network Virtual Appliance (NVA) - Routing</h4><p>Another option would be leveraging <a href=https://azure.microsoft.com/en-us/blog/best-practices-to-consider-before-deploying-a-network-virtual-appliance/ target=_blank rel="noopener noreferrer">NVAs</a> existing in the <em>hub</em> to route traffic between spokes. If we already have the <strong>Cloud DMZ</strong> design deployed, you would use <a href=https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-udr-overview#user-defined target=_blank rel="noopener noreferrer">UDRs</a> to redirect traffic.</p><ul><li>Each <em>subnet</em> requires a <em>UDR</em> to steer traffic</li><li><strong>Destination</strong> matches the subnet prefix from the adjacent VNet</li><li><strong>Next Hop Type</strong> will be defined as <em>Virtual Appliance</em> (<a href=https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-udr-overview#next-hop-types-across-azure-tools target=_blank rel="noopener noreferrer">Next Hop Options</a>)</li><li>The <strong>Next Hop</strong> is the internal load balancer&rsquo;s private IP (If deployed in a <a href=https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/overview target=_blank rel="noopener noreferrer">scale set</a>)</li></ul><p><figure><a class=lightgallery href=/posts/2021/exploring-azure-cloud-networking-part-2/transit-routing-2.png title="Transit Routing - Option 2" data-thumbnail=/posts/2021/exploring-azure-cloud-networking-part-2/transit-routing-2.png data-sub-html="<h2>Transit Routing - 2</h2><p>Transit Routing - Option 2</p>"><img loading=lazy src=/posts/2021/exploring-azure-cloud-networking-part-2/transit-routing-2.png srcset="/posts/2021/exploring-azure-cloud-networking-part-2/transit-routing-2.png, /posts/2021/exploring-azure-cloud-networking-part-2/transit-routing-2.png 1.5x, /posts/2021/exploring-azure-cloud-networking-part-2/transit-routing-2.png 2x" sizes=auto alt="Transit Routing - Option 2" height=1388 width=2344></a><figcaption class=image-caption>Transit Routing - 2</figcaption></figure></p><h2 id=conclusion class=headerLink><a href=#conclusion class=header-mark></a>Conclusion</h2><p>Why not just use a <a href=https://azure.microsoft.com/en-us/services/web-application-firewall/ target=_blank rel="noopener noreferrer">WAF</a> for <strong>Inbound</strong> connections and <a href=https://docs.microsoft.com/en-us/azure/firewall/overview target=_blank rel="noopener noreferrer">Azure Firewall</a> for <strong>Outbound</strong>? It all comes down to what requirements you are working with and the capabilities needed to meet them.</p><p><strong>NextGen Firewalls</strong> have more capabilities today and are also being used heavily in the enterprise. Many will opt to extend these capabilities into the Cloud. Microsoft currently has <a href=https://docs.microsoft.com/en-us/azure/firewall/overview#azure-firewall-premium-preview target=_blank rel="noopener noreferrer">Azure Firewall - Premium</a> in <em>Public Preview</em>, which should close the gap a little more.</p><p>If this material was valuable, check out <a href=https://wcollins.io/posts/2021/exploring-azure-cloud-networking-part-1/ target=_blank rel="noopener noreferrer">Part 1</a> to learn more about the fundamentals. In <em>Part 3</em>, we will dig into <a href=https://azure.microsoft.com/en-us/services/expressroute/ target=_blank rel="noopener noreferrer">ExpressRoute</a> design along with breaking down a few things I wish I would have known before jumping in the <em>deep-end</em>.</p><h3 id=acknowledgements class=headerLink><a href=#acknowledgements class=header-mark></a>Acknowledgements</h3><p>Big thanks to the wise and resourceful <a href=https://www.linkedin.com/in/sthawkins/ target=_blank rel="noopener noreferrer">Steven Hawkins</a> for taking the time to peer review this post. Your feedback is always insightful and appreciated.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 28 April 2021</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-mardown href=/posts/2021/exploring-azure-cloud-networking-part-2/index.md target=_blank rel="noopener noreferrer">Read markdown</a></span></div><div class=post-info-share></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/azure/>azure</a>,&nbsp;<a href=/tags/bgp/>bgp</a>,&nbsp;<a href=/tags/cloud-routing/>cloud routing</a>,&nbsp;<a href=/tags/expressroute/>expressroute</a>,&nbsp;<a href=/tags/hybrid-cloud/>hybrid cloud</a>,&nbsp;<a href=/tags/private-peering/>private peering</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/2021/exploring-azure-cloud-networking-part-1/ class=prev rel=prev title="Exploring Azure Cloud Networking - (Part 1)"><i class="fas fa-angle-left fa-fw"></i>Exploring Azure Cloud Networking - (Part 1)</a>
<a href=/posts/2021/understanding-the-world-of-bitcoin/ class=next rel=next title="Understanding The World Of Bitcoin">Understanding The World Of Bitcoin<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2019 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank rel="noopener noreferrer">William Collins</a></span></div><div class=footer-line></div><div class=footer-line></div></div></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},search:{distance:null,findAllMatches:null,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:null,ignoreLocation:null,isCaseSensitive:null,location:null,maxResultLength:10,minMatchCharLength:null,noResultsFound:"No results found",snippetLength:30,threshold:null,type:"fuse",useExtendedSearch:null}}</script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9QKVT40M3H")</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-9QKVT40M3H" async></script></div></body></html>