<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Cloud Grade Automation With Packer and Terraform - Blog</title><meta name=Description content="Exploring the disruptive world of cloud tech"><meta property="og:title" content="Cloud Grade Automation With Packer and Terraform"><meta property="og:description" content="Manually provisioning infrastructure slows down application delivery, isolates knowledge, can hamper operations teams, and doesn&rsquo;t scale. Automating infrastructure provisioning can address these challenges by shifting manual process into code. Hashicorp has products spanning the infrastructure, security, and application stack that can unlock that cloud operating model and deliver applications faster.
Let&rsquo;s examine image lifecycle management and IaaS deployment. Both of these tasks are common challenges faced by the enterprise when moving to the cloud."><meta property="og:type" content="article"><meta property="og:url" content="http://wcollins.io/posts/2021/cloud-grade-automation-with-packer-and-terraform/"><meta property="og:image" content="http://wcollins.io/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-02-08T12:32:29-05:00"><meta property="article:modified_time" content="2021-02-08T12:32:29-05:00"><meta property="og:site_name" content="Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://wcollins.io/"><meta name=twitter:title content="Cloud Grade Automation With Packer and Terraform"><meta name=twitter:description content="Manually provisioning infrastructure slows down application delivery, isolates knowledge, can hamper operations teams, and doesn&rsquo;t scale. Automating infrastructure provisioning can address these challenges by shifting manual process into code. Hashicorp has products spanning the infrastructure, security, and application stack that can unlock that cloud operating model and deliver applications faster.
Let&rsquo;s examine image lifecycle management and IaaS deployment. Both of these tasks are common challenges faced by the enterprise when moving to the cloud."><meta name=application-name content="Blog"><meta name=apple-mobile-web-app-title content="Blog"><meta name=theme-color content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><meta name=twitter:creator content="@WCollins502"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=http://wcollins.io/posts/2021/cloud-grade-automation-with-packer-and-terraform/><link rel=prev href=http://wcollins.io/posts/2021/cloud-security-and-azure-private-link/><link rel=next href=http://wcollins.io/posts/2021/exploring-azure-cloud-networking-part-1/><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/color.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><meta name=google-site-verification content="FSCEdJZD7nAoKk16ak20hRMKNBvXlnHAU0PBBDZy5DU"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Cloud Grade Automation With Packer and Terraform","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"http://wcollins.io/posts/2021/cloud-grade-automation-with-packer-and-terraform/"},"genre":"posts","keywords":"azure, iaas, immutability, linux, packer, terraform, ubuntu","wordcount":977,"url":"http://wcollins.io/posts/2021/cloud-grade-automation-with-packer-and-terraform/","datePublished":"2021-02-08T12:32:29-05:00","dateModified":"2021-02-08T12:32:29-05:00","publisher":{"@type":"Organization","name":"William Collins"},"author":{"@type":"Person","name":"William Collins"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark"),window.theme=e,window.isDark=window.theme!=="light"}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else"light"==="light"||"light"==="dark"||"light"==="black"?(setTheme("light"),saveTheme("light")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")],window.switchThemeEventSet=new Set</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Blog></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/>Home </a><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/talks/>Talks </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about>About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Blog></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/ title>Home</a><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/talks/ title>Talks</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#what-is-cloud-grade-automation>What Is Cloud Grade Automation?</a></li><li><a href=#evolving-automation>Evolving Automation</a><ul><li><a href=#runtime---mutable>Runtime - (Mutable)</a></li><li><a href=#build-time---immutable>Build-time - (Immutable)</a></li></ul></li><li><a href=#getting-started-with-packer>Getting Started With Packer</a><ul><li><a href=#building-a-machine-image>Building A Machine Image</a></li></ul></li><li><a href=#getting-started-with-terraform>Getting Started With Terraform</a><ul><li><a href=#deploying-some-infrastructure>Deploying Some Infrastructure</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Cloud Grade Automation With Packer and Terraform</h1><div class=post-meta><div class=post-meta-line><span class=post-author><span class="author fas fa-user-circle fa-fw"></span><a href=/ title=Author rel=author class=author>William Collins</a>
</span>&nbsp;<span class=post-category>included in </span>&nbsp;<span class=post-category>categories <a href=/categories/automation/><i class="far fa-folder fa-fw"></i>automation</a>&nbsp;<a href=/categories/cloud/><i class="far fa-folder fa-fw"></i>cloud</a>&nbsp;<a href=/categories/tools/><i class="far fa-folder fa-fw"></i>tools</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="8 February 2021">8 February 2021</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="8 February 2021">8 February 2021</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;977 words&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;5 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#what-is-cloud-grade-automation>What Is Cloud Grade Automation?</a></li><li><a href=#evolving-automation>Evolving Automation</a><ul><li><a href=#runtime---mutable>Runtime - (Mutable)</a></li><li><a href=#build-time---immutable>Build-time - (Immutable)</a></li></ul></li><li><a href=#getting-started-with-packer>Getting Started With Packer</a><ul><li><a href=#building-a-machine-image>Building A Machine Image</a></li></ul></li><li><a href=#getting-started-with-terraform>Getting Started With Terraform</a><ul><li><a href=#deploying-some-infrastructure>Deploying Some Infrastructure</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></div><div class=content id=content><p>Manually provisioning infrastructure slows down application delivery, isolates knowledge, can hamper operations teams, and doesn&rsquo;t scale. Automating infrastructure provisioning can address these challenges by shifting manual process into code. <a href=https://www.hashicorp.com/ target=_blank rel="noopener noreferrer">Hashicorp</a> has products spanning the infrastructure, security, and application stack that can unlock that cloud operating model and deliver applications faster.</p><p>Let&rsquo;s examine <em>image lifecycle management</em> and <em>IaaS deployment</em>. Both of these tasks are common challenges faced by the <em>enterprise</em> when moving to the cloud. Using <a href=https://www.packer.io/ target=_blank rel="noopener noreferrer">Packer</a>, we can <em>automate</em> the build process for images and then deploy common infrastructure and <a href=https://azure.microsoft.com/en-us/services/virtual-machines/ target=_blank rel="noopener noreferrer">virtual machines</a> with <a href=https://www.terraform.io/ target=_blank rel="noopener noreferrer">Terraform</a>.</p><p><figure><a class=lightgallery href=/posts/2021/cloud-grade-automation-with-packer-and-terraform/cloud-grade-intro.png title="Cloud Grade Intro" data-thumbnail=/posts/2021/cloud-grade-automation-with-packer-and-terraform/cloud-grade-intro.png data-sub-html="<h2>Intro</h2><p>Cloud Grade Intro</p>"><img loading=lazy src=/posts/2021/cloud-grade-automation-with-packer-and-terraform/cloud-grade-intro.png srcset="/posts/2021/cloud-grade-automation-with-packer-and-terraform/cloud-grade-intro.png, /posts/2021/cloud-grade-automation-with-packer-and-terraform/cloud-grade-intro.png 1.5x, /posts/2021/cloud-grade-automation-with-packer-and-terraform/cloud-grade-intro.png 2x" sizes=auto alt="Cloud Grade Intro" height=1196 width=2297></a><figcaption class=image-caption>Intro</figcaption></figure></p><h2 id=what-is-cloud-grade-automation class=headerLink><a href=#what-is-cloud-grade-automation class=header-mark></a>What Is Cloud Grade Automation?</h2><p>I started using this expression as a <em>catch phrase</em> some time back, mainly in Powerpoint slides. The way I would describe its meaning goes well beyond a single tool, process, or methodology. To me, it embodies the core guiding principles for cloud and application delivery in today&rsquo;s landscape. Let&rsquo;s start with the outcomes we are aiming for:</p><ul><li>Loosely coupled application architecture; Cloud Native</li><li>Infrastructure hosting a given application is delivered intact</li><li>Infrastructure is never touched, changed, or otherwise modified in any way</li><li>When changes are necessary, the environment is re-deployed from the newest artifact</li><li>Rollback occurs in the same way except with an older versioned artifact</li></ul><p>The culture, tooling, process, and delivery that can achieve these outcomes, is my impression of what <em>Cloud Grade Automation</em> is. I&rsquo;ll be focusing specifically on the tooling and delivery in this post.</p><h2 id=evolving-automation class=headerLink><a href=#evolving-automation class=header-mark></a>Evolving Automation</h2><p>Automation can typically be handled at two different stages of a given <em>workflow</em>. Choosing which stage can ultimately drive <em>operational</em> decisions. As application architectures have evolved, the automation used to build the infrastructure has transformed. Complexity has largely shifted from <em>runtime</em> to <em>build-time</em>.</p><h3 id=runtime---mutable class=headerLink><a href=#runtime---mutable class=header-mark></a>Runtime - (Mutable)</h3><p>When we think <em>automation</em>, folks that have been around a while typically think in terms of <em>mutable</em>. This means we deploy our server and then configure, update, or modify it <em>in-place</em>. I have seen anything from scripts (Shell, Perl, and Python) to configuration management tools like <a href=https://www.ansible.com/ target=_blank rel="noopener noreferrer">Ansible</a>, <a href=https://www.chef.io/ target=_blank rel="noopener noreferrer">Chef</a> and <a href=https://puppet.com/ target=_blank rel="noopener noreferrer">Puppet</a> used to accomplish this.</p><blockquote><p><a href=https://www.merriam-webster.com/dictionary/mutable target=_blank rel="noopener noreferrer">Webster</a> defines <em>mutable</em> as <strong>":prone to change: INCONSTANT"</strong>.</p></blockquote><p>To further expand on <em>runtime</em> configuration, let&rsquo;s take the example of installing an agent-based solution. For the sake of demonstration, let&rsquo;s say that each virtual machine provisioned in our infrastructure requires running <a href=https://www.thousandeyes.com/product/enterprise-agents target=_blank rel="noopener noreferrer">ThousandEyes - Enterprise Agents</a> for monitoring.</p><ul><li>A <em>greenfield</em> application is getting developed; New infrastructure is required (Develop)</li><li>The new server (or multiple servers) are provisioned for the application to run on (Deploy)</li><li>Config Management tooling applies the standard configuration, including the Agent (Configure)</li></ul><p><figure><a class=lightgallery href=/posts/2021/cloud-grade-automation-with-packer-and-terraform/mutable-workflow.png title="Mutable Workflow" data-thumbnail=/posts/2021/cloud-grade-automation-with-packer-and-terraform/mutable-workflow.png data-sub-html="<h2>Mutable</h2><p>Mutable Workflow</p>"><img loading=lazy src=/posts/2021/cloud-grade-automation-with-packer-and-terraform/mutable-workflow.png srcset="/posts/2021/cloud-grade-automation-with-packer-and-terraform/mutable-workflow.png, /posts/2021/cloud-grade-automation-with-packer-and-terraform/mutable-workflow.png 1.5x, /posts/2021/cloud-grade-automation-with-packer-and-terraform/mutable-workflow.png 2x" sizes=auto alt="Mutable Workflow" height=1571 width=4710></a><figcaption class=image-caption>Mutable</figcaption></figure></p><p><em>Mutable</em> infrastructure is susceptible to <em>configuration drift</em>. As individual changes get applied on servers throughout their lifecycle, the configuration will significantly differ from the <em>desired state</em> and other servers across the environment.</p><h3 id=build-time---immutable class=headerLink><a href=#build-time---immutable class=header-mark></a>Build-time - (Immutable)</h3><p><em>Immutable</em> infrastructure aims to reduce the number of moving pieces at <em>runtime</em>. Handling infrastructure this way speeds up delivery, eliminates configuration drift, increases environment consistency, optimizes rollback, and simplifies horizontal scaling.</p><blockquote><p><a href=https://www.merriam-webster.com/dictionary/immutable target=_blank rel="noopener noreferrer">Webster</a> defines <em>immutable</em> as <strong>":not capable of or susceptible to change"</strong>.</p></blockquote><p>To further expand on <em>build-time</em> configuration, let&rsquo;s take the same example used above:</p><ul><li>A <em>greenfield</em> application is getting developed; New infrastructure is required (Develop)</li><li>The standard configuration and <em>Enterprise Agent</em> get packaged at build-time (Configure)</li><li>Infrastructure is provisioned using the machine template and deployed at <em>runtime</em> (Deploy)</li></ul><p><figure><a class=lightgallery href=/posts/2021/cloud-grade-automation-with-packer-and-terraform/immutable-workflow.png title="Immutable Workflow" data-thumbnail=/posts/2021/cloud-grade-automation-with-packer-and-terraform/immutable-workflow.png data-sub-html="<h2>Immutable</h2><p>Immutable Workflow</p>"><img loading=lazy src=/posts/2021/cloud-grade-automation-with-packer-and-terraform/immutable-workflow.png srcset="/posts/2021/cloud-grade-automation-with-packer-and-terraform/immutable-workflow.png, /posts/2021/cloud-grade-automation-with-packer-and-terraform/immutable-workflow.png 1.5x, /posts/2021/cloud-grade-automation-with-packer-and-terraform/immutable-workflow.png 2x" sizes=auto alt="Immutable Workflow" height=1573 width=4684></a><figcaption class=image-caption>Immutable</figcaption></figure></p><p>Building <em>immutable</em> infrastructure can be a significant undertaking when considering the transition of <em>brownfield</em> applications. One dependency ensures that the <em>application layer</em> remains <a href=https://en.wikipedia.org/wiki/Service_statelessness_principle target=_blank rel="noopener noreferrer">stateless</a>, including servers. Anything at this level should and will be consistently destroyed and rebuilt.</p><h2 id=getting-started-with-packer class=headerLink><a href=#getting-started-with-packer class=header-mark></a>Getting Started With Packer</h2><p><a href=https://www.packer.io/ target=_blank rel="noopener noreferrer">Packer</a> automates the creation of any machine image. Once the image is packaged, it can then be provisioned with Terraform. While this is the new, modern, cool, and cloud way to accomplish this, other methods have existed for a very long time. Back in 2014, I was doing <em>non-interactive</em> installs of various Linux distributions on <a href=https://www.linux-kvm.org/page/Main_Page target=_blank rel="noopener noreferrer">Linux KVM</a> with <a href=https://libvirt.org/manpages/virsh.html target=_blank rel="noopener noreferrer">virsh</a> and <a href=https://linux.die.net/man/1/virt-install target=_blank rel="noopener noreferrer">virt-install</a>. Virt-install would use <em>libvirt&rsquo;s</em> streaming API to upload the kernel and modified <em>initrd</em> to the remote host.</p><p><figure><a class=lightgallery href=/posts/2021/cloud-grade-automation-with-packer-and-terraform/packer-overview.png title="Packer Overview" data-thumbnail=/posts/2021/cloud-grade-automation-with-packer-and-terraform/packer-overview.png data-sub-html="<h2>Packer</h2><p>Packer Overview</p>"><img loading=lazy src=/posts/2021/cloud-grade-automation-with-packer-and-terraform/packer-overview.png srcset="/posts/2021/cloud-grade-automation-with-packer-and-terraform/packer-overview.png, /posts/2021/cloud-grade-automation-with-packer-and-terraform/packer-overview.png 1.5x, /posts/2021/cloud-grade-automation-with-packer-and-terraform/packer-overview.png 2x" sizes=auto alt="Packer Overview" height=591 width=2276></a><figcaption class=image-caption>Packer</figcaption></figure></p><h3 id=building-a-machine-image class=headerLink><a href=#building-a-machine-image class=header-mark></a>Building A Machine Image</h3><p>As an example, let&rsquo;s package an <a href=https://releases.ubuntu.com/18.04/ target=_blank rel="noopener noreferrer">Ubuntu 18.04</a> image with a <a href=https://www.thousandeyes.com/product/enterprise-agents target=_blank rel="noopener noreferrer">ThousandEyes - Agent</a>. Although an overly simplistic example, it should demonstrate our desired intent and behavior. Demo code can be found <a href=https://github.com/wcollins/packer-azure-demo-linux target=_blank rel="noopener noreferrer">here.</a></p><p><figure><a class=lightgallery href=/posts/2021/cloud-grade-automation-with-packer-and-terraform/packer-build.gif title="Packer Build" data-thumbnail=/posts/2021/cloud-grade-automation-with-packer-and-terraform/packer-build.gif data-sub-html="<h2>Packer</h2><p>Packer Build</p>"><img loading=lazy src=/posts/2021/cloud-grade-automation-with-packer-and-terraform/packer-build.gif srcset="/posts/2021/cloud-grade-automation-with-packer-and-terraform/packer-build.gif, /posts/2021/cloud-grade-automation-with-packer-and-terraform/packer-build.gif 1.5x, /posts/2021/cloud-grade-automation-with-packer-and-terraform/packer-build.gif 2x" sizes=auto alt="Packer Build" height=679 width=1768></a><figcaption class=image-caption>Packer</figcaption></figure></p><p><a href=https://github.com/wcollins/packer-azure-demo-linux/blob/master/ubuntu-18.04-LTS.json target=_blank rel="noopener noreferrer"><strong>ubuntu-18.04-LTS.json</strong></a>
<script type=application/javascript src=https://gist.github.com/wcollins/d795c88016310886d0bce209004e6636.js></script></p><blockquote><p>Instead of using the <em>shell</em> provisioner to deploy the agent (see line 35 in the template), a more elegant method would call the <strong>&ldquo;type&rdquo;: &ldquo;ansible&rdquo;</strong> provisioner pointing to a <strong>playbook.yml</strong> file in the repository. This would allow you to separate packages into separate playbooks managed in <em>version control</em>.</p></blockquote><h2 id=getting-started-with-terraform class=headerLink><a href=#getting-started-with-terraform class=header-mark></a>Getting Started With Terraform</h2><p><figure><a class=lightgallery href=/posts/2021/cloud-grade-automation-with-packer-and-terraform/terraform-overview.png title="Terraform Overview" data-thumbnail=/posts/2021/cloud-grade-automation-with-packer-and-terraform/terraform-overview.png data-sub-html="<h2>Terraform</h2><p>Terraform Overview</p>"><img loading=lazy src=/posts/2021/cloud-grade-automation-with-packer-and-terraform/terraform-overview.png srcset="/posts/2021/cloud-grade-automation-with-packer-and-terraform/terraform-overview.png, /posts/2021/cloud-grade-automation-with-packer-and-terraform/terraform-overview.png 1.5x, /posts/2021/cloud-grade-automation-with-packer-and-terraform/terraform-overview.png 2x" sizes=auto alt="Terraform Overview" height=1037 width=3266></a><figcaption class=image-caption>Terraform</figcaption></figure></p><p><a href=https://www.terraform.io/ target=_blank rel="noopener noreferrer">Terraform</a> codifies cloud APIs into declarative configuration files. If you want to create reproducible infrastructure for consistent testing, staging, and production environments with the same configuration, look no further! While it&rsquo;s generally not that simple, Terraform does seem to be the <em>defacto</em> tool these days for <em>Infrastructure as Code</em> in the cloud.</p><h3 id=deploying-some-infrastructure class=headerLink><a href=#deploying-some-infrastructure class=header-mark></a>Deploying Some Infrastructure</h3><p>Let&rsquo;s deploy some foundational infrastructure along with a <a href=https://azure.microsoft.com/en-us/services/virtual-machines/ target=_blank rel="noopener noreferrer">virtual machine</a> provisioned from the <em>machine image</em> we built above with Packer. Demo code can be found <a href=https://github.com/wcollins/terraform-azure-demo-vm target=_blank rel="noopener noreferrer">here.</a></p><p><figure><a class=lightgallery href=/posts/2021/cloud-grade-automation-with-packer-and-terraform/terraform-deploy.gif title="Terraform Deploy" data-thumbnail=/posts/2021/cloud-grade-automation-with-packer-and-terraform/terraform-deploy.gif data-sub-html="<h2>Deploy</h2><p>Terraform Deploy</p>"><img loading=lazy src=/posts/2021/cloud-grade-automation-with-packer-and-terraform/terraform-deploy.gif srcset="/posts/2021/cloud-grade-automation-with-packer-and-terraform/terraform-deploy.gif, /posts/2021/cloud-grade-automation-with-packer-and-terraform/terraform-deploy.gif 1.5x, /posts/2021/cloud-grade-automation-with-packer-and-terraform/terraform-deploy.gif 2x" sizes=auto alt="Terraform Deploy" height=751 width=1706></a><figcaption class=image-caption>Deploy</figcaption></figure></p><p><a href=https://github.com/wcollins/terraform-azure-demo-vm/blob/master/main.tf target=_blank rel="noopener noreferrer"><strong>main.tf</strong></a>
<script type=application/javascript src=https://gist.github.com/wcollins/20de391d07fb186ce7ce200b769b9acd.js></script></p><blockquote><p>This template is an example. In practice, this would probably be broken up into at least two distinct modules (network and compute). If specific groups of resources have a similar life cycle, you would probably create a module for them. An example of this might be core network components like VNets, Subnets, and UDRs.</p></blockquote><h2 id=conclusion class=headerLink><a href=#conclusion class=header-mark></a>Conclusion</h2><p>Learning to use <a href=https://packer.io target=_blank rel="noopener noreferrer">Packer</a> or writing <a href=https://terraform.io target=_blank rel="noopener noreferrer">Terraform</a> templates is a tiny piece of a vast puzzle. If the desired outcome is <a href=https://https://aws.amazon.com/devops/continuous-delivery/ target=_blank rel="noopener noreferrer">Continuous Delivery</a> then application architecture, cultural philosophies, and <a href="https://https://en.wikipedia.org/wiki/Release_management#:~:text=Release%20management%20is%20the%20process,testing%20and%20deploying%20software%20releases." target=_blank rel="noopener noreferrer">release management</a> all play equally important roles.</p><p>Enterprise Leaders all want <a href="https://https://en.wikipedia.org/wiki/DevOps#:~:text=DevOps%20is%20a%20set%20of,delivery%20with%20high%20software%20quality." target=_blank rel="noopener noreferrer">DevOps</a> for the benefits of automation, quicker releases, reduced downtime, reliable recovery from disasters, and cost benefits in the cloud <strong>(That last one makes me chuckle)</strong>. The real question is, will they do what is necessary to buck traditional culture and adopt truly immutable infrastructure?</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 8 February 2021</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-mardown href=/posts/2021/cloud-grade-automation-with-packer-and-terraform/index.md target=_blank rel="noopener noreferrer">Read markdown</a></span></div><div class=post-info-share></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/azure/>azure</a>,&nbsp;<a href=/tags/iaas/>iaas</a>,&nbsp;<a href=/tags/immutability/>immutability</a>,&nbsp;<a href=/tags/linux/>linux</a>,&nbsp;<a href=/tags/packer/>packer</a>,&nbsp;<a href=/tags/terraform/>terraform</a>,&nbsp;<a href=/tags/ubuntu/>ubuntu</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/2021/cloud-security-and-azure-private-link/ class=prev rel=prev title="Cloud Security And Azure Private Link"><i class="fas fa-angle-left fa-fw"></i>Cloud Security And Azure Private Link</a>
<a href=/posts/2021/exploring-azure-cloud-networking-part-1/ class=next rel=next title="Exploring Azure Cloud Networking - (Part 1)">Exploring Azure Cloud Networking - (Part 1)<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2019 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank rel="noopener noreferrer">William Collins</a></span></div><div class=footer-line></div><div class=footer-line></div></div></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},search:{distance:null,findAllMatches:null,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:null,ignoreLocation:null,isCaseSensitive:null,location:null,maxResultLength:10,minMatchCharLength:null,noResultsFound:"No results found",snippetLength:30,threshold:null,type:"fuse",useExtendedSearch:null}}</script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9QKVT40M3H")</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-9QKVT40M3H" async></script></div></body></html>