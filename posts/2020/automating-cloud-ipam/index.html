<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>AnsibleFest 2020 - Automating IPAM In Cloud - Blog</title><meta name=Description content="Exploring the disruptive world of cloud tech"><meta property="og:title" content="AnsibleFest 2020 - Automating IPAM In Cloud"><meta property="og:description" content="AnsibleFest AnsibleFest 2020, like most conferences this year, took place completely virtual. I presented on Automating IPAM In Cloud: Ansible + Netbox. You can find the slides along with the demonstration code in this git repo. In this post, I&rsquo;m going to expand a little further on the content I presented.
What is IPAM?IP Address Management (IPAM) is the critical component that organizes your IP addresses and networks in one place."><meta property="og:type" content="article"><meta property="og:url" content="http://wcollins.io/posts/2020/automating-cloud-ipam/"><meta property="og:image" content="http://wcollins.io/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-10-13T07:16:08-04:00"><meta property="article:modified_time" content="2020-10-13T07:16:08-04:00"><meta property="og:site_name" content="Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://wcollins.io/"><meta name=twitter:title content="AnsibleFest 2020 - Automating IPAM In Cloud"><meta name=twitter:description content="AnsibleFest AnsibleFest 2020, like most conferences this year, took place completely virtual. I presented on Automating IPAM In Cloud: Ansible + Netbox. You can find the slides along with the demonstration code in this git repo. In this post, I&rsquo;m going to expand a little further on the content I presented.
What is IPAM?IP Address Management (IPAM) is the critical component that organizes your IP addresses and networks in one place."><meta name=application-name content="Blog"><meta name=apple-mobile-web-app-title content="Blog"><meta name=theme-color content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><meta name=twitter:creator content="@WCollins502"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=http://wcollins.io/posts/2020/automating-cloud-ipam/><link rel=prev href=http://wcollins.io/posts/2020/alkira-multicloud-networking/><link rel=next href=http://wcollins.io/posts/2021/cloud-security-and-azure-private-link/><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/color.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><meta name=google-site-verification content="FSCEdJZD7nAoKk16ak20hRMKNBvXlnHAU0PBBDZy5DU"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"AnsibleFest 2020 - Automating IPAM In Cloud","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"http://wcollins.io/posts/2020/automating-cloud-ipam/"},"genre":"posts","keywords":"ansible, ansiblefest, azure, ipam, netbox, cisco asr","wordcount":1624,"url":"http://wcollins.io/posts/2020/automating-cloud-ipam/","datePublished":"2020-10-13T07:16:08-04:00","dateModified":"2020-10-13T07:16:08-04:00","publisher":{"@type":"Organization","name":"William Collins"},"author":{"@type":"Person","name":"William Collins"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark"),window.theme=e,window.isDark=window.theme!=="light"}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else"light"==="light"||"light"==="dark"||"light"==="black"?(setTheme("light"),saveTheme("light")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")],window.switchThemeEventSet=new Set</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Blog></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/>Home </a><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/talks/>Talks </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about>About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Blog></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/ title>Home</a><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/talks/ title>Talks</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#what-is-ipam>What is IPAM?</a></li><li><a href=#the-problem>The Problem</a><ul><li><a href=#boundaries-are-blurred>Boundaries Are Blurred</a></li><li><a href=#inconsistency-in-data-domains>Inconsistency In Data Domains</a></li></ul></li><li><a href=#what-is-our-desired-outcome>What Is Our Desired Outcome?</a></li><li><a href=#why-automate-here>Why Automate Here?</a><ul><li><a href=#why-ansible-and-netbox>Why Ansible and Netbox?</a></li><li><a href=#prerequisites>Prerequisites</a></li></ul></li><li><a href=#what-are-we-automating>What Are We Automating?</a><ul><li><a href=#the-technology>The Technology</a></li><li><a href=#digging-down-into-the-environments>Digging Down Into The Environments</a></li></ul></li><li><a href=#design-drives-automation>Design Drives Automation</a><ul><li><a href=#standard-workflows>Standard Workflows</a></li><li><a href=#a-scalable-tagging-system>A Scalable Tagging System</a></li><li><a href=#touchpoints>Touchpoints</a></li></ul></li><li><a href=#breaking-down-the-logic>Breaking Down The Logic</a><ul><li><a href=#project-structure>Project Structure</a></li><li><a href=#ansible-collections>Ansible Collections</a></li><li><a href=#high-level-plays>High-Level Plays</a></li><li><a href=#functional-roles>Functional Roles</a></li><li><a href=#purpose-built-tasks>Purpose Built Tasks</a></li><li><a href=#the-physical-network>The Physical Network</a></li></ul></li><li><a href=#putting-it-all-together>Putting It All Together</a><ul><li><a href=#job-templates>Job Templates</a></li><li><a href=#workflow-templates>Workflow Templates</a></li><li><a href=#workflow-visualizer>Workflow Visualizer</a></li><li><a href=#using-surveys>Using Surveys</a></li><li><a href=#workflows-in-action>Workflows In Action</a></li><li><a href=#a-little-manual-validation>A Little Manual Validation</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">AnsibleFest 2020 - Automating IPAM In Cloud</h1><div class=post-meta><div class=post-meta-line><span class=post-author><span class="author fas fa-user-circle fa-fw"></span><a href=/ title=Author rel=author class=author>William Collins</a>
</span>&nbsp;<span class=post-category>included in </span>&nbsp;<span class=post-category>categories <a href=/categories/automation/><i class="far fa-folder fa-fw"></i>automation</a>&nbsp;<a href=/categories/cloud/><i class="far fa-folder fa-fw"></i>cloud</a>&nbsp;<a href=/categories/conference/><i class="far fa-folder fa-fw"></i>conference</a>&nbsp;<a href=/categories/netdevops/><i class="far fa-folder fa-fw"></i>netdevops</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="13 October 2020">13 October 2020</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="13 October 2020">13 October 2020</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1624 words&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;8 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#what-is-ipam>What is IPAM?</a></li><li><a href=#the-problem>The Problem</a><ul><li><a href=#boundaries-are-blurred>Boundaries Are Blurred</a></li><li><a href=#inconsistency-in-data-domains>Inconsistency In Data Domains</a></li></ul></li><li><a href=#what-is-our-desired-outcome>What Is Our Desired Outcome?</a></li><li><a href=#why-automate-here>Why Automate Here?</a><ul><li><a href=#why-ansible-and-netbox>Why Ansible and Netbox?</a></li><li><a href=#prerequisites>Prerequisites</a></li></ul></li><li><a href=#what-are-we-automating>What Are We Automating?</a><ul><li><a href=#the-technology>The Technology</a></li><li><a href=#digging-down-into-the-environments>Digging Down Into The Environments</a></li></ul></li><li><a href=#design-drives-automation>Design Drives Automation</a><ul><li><a href=#standard-workflows>Standard Workflows</a></li><li><a href=#a-scalable-tagging-system>A Scalable Tagging System</a></li><li><a href=#touchpoints>Touchpoints</a></li></ul></li><li><a href=#breaking-down-the-logic>Breaking Down The Logic</a><ul><li><a href=#project-structure>Project Structure</a></li><li><a href=#ansible-collections>Ansible Collections</a></li><li><a href=#high-level-plays>High-Level Plays</a></li><li><a href=#functional-roles>Functional Roles</a></li><li><a href=#purpose-built-tasks>Purpose Built Tasks</a></li><li><a href=#the-physical-network>The Physical Network</a></li></ul></li><li><a href=#putting-it-all-together>Putting It All Together</a><ul><li><a href=#job-templates>Job Templates</a></li><li><a href=#workflow-templates>Workflow Templates</a></li><li><a href=#workflow-visualizer>Workflow Visualizer</a></li><li><a href=#using-surveys>Using Surveys</a></li><li><a href=#workflows-in-action>Workflows In Action</a></li><li><a href=#a-little-manual-validation>A Little Manual Validation</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></div><div class=content id=content><p><figure><a class=lightgallery href=/posts/2020/automating-cloud-ipam/ansible-fest.png title="AnsibleFest - 2020" data-thumbnail=/posts/2020/automating-cloud-ipam/ansible-fest.png data-sub-html="<h2>AnsibleFest</h2><p>AnsibleFest - 2020</p>"><img loading=lazy src=/posts/2020/automating-cloud-ipam/ansible-fest.png srcset="/posts/2020/automating-cloud-ipam/ansible-fest.png, /posts/2020/automating-cloud-ipam/ansible-fest.png 1.5x, /posts/2020/automating-cloud-ipam/ansible-fest.png 2x" sizes=auto alt="AnsibleFest - 2020" height=533 width=2138></a><figcaption class=image-caption>AnsibleFest</figcaption></figure></p><p><a href=https://www.ansible.com/ansiblefest target=_blank rel="noopener noreferrer">AnsibleFest 2020</a>, like most conferences this year, took place completely virtual. I presented on <em>Automating IPAM In Cloud: Ansible + Netbox</em>. You can find the slides along with the demonstration code in <a href=https://github.com/wcollins/ansible-cloud-ipam target=_blank rel="noopener noreferrer">this git repo.</a> In this post, I&rsquo;m going to expand a little further on the content I presented.</p><h2 id=what-is-ipam class=headerLink><a href=#what-is-ipam class=header-mark></a>What is IPAM?</h2><p><em>IP Address Management (IPAM)</em> is the critical component that organizes your IP addresses and networks in one place. Responsible management of IP addressing drives efficient, repeatable, and reliable network automation. It is also a dependency for many other types of automation. Think of all the things that require IP addresses to communicate?</p><p><figure><a class=lightgallery href=/posts/2020/automating-cloud-ipam/what-is-ipam.png title="What is IPAM?" data-thumbnail=/posts/2020/automating-cloud-ipam/what-is-ipam.png data-sub-html="<h2>IPAM</h2><p>What is IPAM?</p>"><img loading=lazy src=/posts/2020/automating-cloud-ipam/what-is-ipam.png srcset="/posts/2020/automating-cloud-ipam/what-is-ipam.png, /posts/2020/automating-cloud-ipam/what-is-ipam.png 1.5x, /posts/2020/automating-cloud-ipam/what-is-ipam.png 2x" sizes=auto alt="What is IPAM?" height=1127 width=2938></a><figcaption class=image-caption>IPAM</figcaption></figure></p><h2 id=the-problem class=headerLink><a href=#the-problem class=header-mark></a>The Problem</h2><p>If you are <em>hybrid multi-cloud</em>, it probably means you share the same <a href=https://en.wikipedia.org/wiki/Private_network target=_blank rel="noopener noreferrer">RFC1918</a> space across clouds and traditional networking. If this is the case, it means you probably want to keep track of allocation across <em>VNets</em>, <em>Subnets</em>, and <em>VMs</em>.</p><h3 id=boundaries-are-blurred class=headerLink><a href=#boundaries-are-blurred class=header-mark></a>Boundaries Are Blurred</h3><ul><li>As Hybrid Multi-Cloud becomes a reality, private IP space becomes shared across cloud(s) and on-premises</li><li>Developers leverage <strong>CI/CD</strong> as they deploy, maintain, and migrate applications in the cloud; network can&rsquo;t keep up</li><li>Some developers do not have a good understanding of how IP addressing works and how to consume it responsibly</li></ul><p><figure><a class=lightgallery href=/posts/2020/automating-cloud-ipam/the-problem.png title="The Problem" data-thumbnail=/posts/2020/automating-cloud-ipam/the-problem.png data-sub-html="<h2>Problem</h2><p>The Problem</p>"><img loading=lazy src=/posts/2020/automating-cloud-ipam/the-problem.png srcset="/posts/2020/automating-cloud-ipam/the-problem.png, /posts/2020/automating-cloud-ipam/the-problem.png 1.5x, /posts/2020/automating-cloud-ipam/the-problem.png 2x" sizes=auto alt="The Problem" height=1208 width=2243></a><figcaption class=image-caption>Problem</figcaption></figure></p><h3 id=inconsistency-in-data-domains class=headerLink><a href=#inconsistency-in-data-domains class=header-mark></a>Inconsistency In Data Domains</h3><ul><li>Data required for efficient automation is often dispersed across many tools and platforms</li><li>Frequently, overlap can exist between these tools and platforms for a given data domain</li><li>Tools and platforms may be owned and managed by different teams with different directions</li><li>Good automation is dependent on data accuracy, consistency, and ability to be consumed</li></ul><p><figure><a class=lightgallery href=/posts/2020/automating-cloud-ipam/data-domains.png title="Data Domains" data-thumbnail=/posts/2020/automating-cloud-ipam/data-domains.png data-sub-html="<h2>Data Domains</h2><p>Data Domains</p>"><img loading=lazy src=/posts/2020/automating-cloud-ipam/data-domains.png srcset="/posts/2020/automating-cloud-ipam/data-domains.png, /posts/2020/automating-cloud-ipam/data-domains.png 1.5x, /posts/2020/automating-cloud-ipam/data-domains.png 2x" sizes=auto alt="Data Domains" height=1498 width=2008></a><figcaption class=image-caption>Data Domains</figcaption></figure></p><h2 id=what-is-our-desired-outcome class=headerLink><a href=#what-is-our-desired-outcome class=header-mark></a>What Is Our Desired Outcome?</h2><p>Aside from the idea that we want to automate IP address management, the main focus is <strong>user experience</strong>. This encompasses the overall experience for those designing for the future, supporting current, and consuming cloud networking services. The following considerations are critical:</p><ul><li>Minimal human intervention</li><li>Repeatable with other cloud providers</li><li>Compatible across traditional + cloud networking</li><li>End-to-end network automation</li></ul><h2 id=why-automate-here class=headerLink><a href=#why-automate-here class=header-mark></a>Why Automate Here?</h2><p>If <a href=https://www.tesla.com/ target=_blank rel="noopener noreferrer"><em>Tesla</em></a> can make self-driving cars and my coffee maker turns itself on in the morning, we can automate <em>IPAM</em> across the <em>hybrid multi-cloud</em> network, right? Also, the cloud demands agility. If you want agility, you need design patterns to build something repeatable against. If you manage IPAM in the cloud with any Microsoft Office tool, you are doing it wrong.</p><h3 id=why-ansible-and-netbox class=headerLink><a href=#why-ansible-and-netbox class=header-mark></a>Why Ansible and Netbox?</h3><p>Leveraging something like <a href=https://ansible.com target=_blank rel="noopener noreferrer">Ansible</a> begins to make sense when the goal is automation at scale for networking across multiple vendors and environments. <a href=https://netbox.readthedocs.io/en/stable target=_blank rel="noopener noreferrer">Netbox</a> can serve as a Source of Truth intended to represent the <em>desired</em> state of a network versus its <em>operational</em> state. The API is very flexible, and the functionality can drive many automation use cases well beyond IPAM.</p><h3 id=prerequisites class=headerLink><a href=#prerequisites class=header-mark></a>Prerequisites</h3><p>This post will not detail how to deploy Ansible or Netbox as there is plenty of examples out there already. There is excellent documentation for setting up both of these platforms via <a href=https://docker.com target=_blank rel="noopener noreferrer">Docker</a>. Instructions for setting up <em>Ansible AWX</em> can be found <a href=https://github.com/ansible/awx target=_blank rel="noopener noreferrer">here</a> and <em>Netbox</em> <a href=https://github.com/netbox-community/netbox-docker target=_blank rel="noopener noreferrer">here.</a></p><p>To authenticate to an Azure subscription, you will need to create a <a href=https://docs.microsoft.com/en-us/azure/active-directory/develop/app-objects-and-service-principals target=_blank rel="noopener noreferrer">Service Principal</a>. Once a Service Principal is created, you will need to assign a role so that you can access the resources in that subscription. Detailed instructions for completing these steps can be found <a href=https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal target=_blank rel="noopener noreferrer">here.</a></p><h2 id=what-are-we-automating class=headerLink><a href=#what-are-we-automating class=header-mark></a>What Are We Automating?</h2><p>Let&rsquo;s examine the cloud environment so we can begin formulating our approach for how we want to automate.</p><h3 id=the-technology class=headerLink><a href=#the-technology class=header-mark></a>The Technology</h3><p><figure><a class=lightgallery href=/posts/2020/automating-cloud-ipam/the-tech.png title="The Tech" data-thumbnail=/posts/2020/automating-cloud-ipam/the-tech.png data-sub-html="<h2>The Tech</h2><p>The Tech</p>"><img loading=lazy src=/posts/2020/automating-cloud-ipam/the-tech.png srcset="/posts/2020/automating-cloud-ipam/the-tech.png, /posts/2020/automating-cloud-ipam/the-tech.png 1.5x, /posts/2020/automating-cloud-ipam/the-tech.png 2x" sizes=auto alt="The Tech" height=1029 width=2498></a><figcaption class=image-caption>The Tech</figcaption></figure></p><h3 id=digging-down-into-the-environments class=headerLink><a href=#digging-down-into-the-environments class=header-mark></a>Digging Down Into The Environments</h3><p>In the cloud, you generally have a hierarchy in which logical components exist, which may contain additional logical components. With Azure, for instance, management groups include subscriptions. Subscriptions hold Resource Groups, which include VNets. A VNet may be a shared resource across many apps and services in scope across many teams.</p><p><figure><a class=lightgallery href=/posts/2020/automating-cloud-ipam/cloud-azure-env.png title="Cloud Environment" data-thumbnail=/posts/2020/automating-cloud-ipam/cloud-azure-env.png data-sub-html="<h2>Cloud Environment</h2><p>Cloud Environment</p>"><img loading=lazy src=/posts/2020/automating-cloud-ipam/cloud-azure-env.png srcset="/posts/2020/automating-cloud-ipam/cloud-azure-env.png, /posts/2020/automating-cloud-ipam/cloud-azure-env.png 1.5x, /posts/2020/automating-cloud-ipam/cloud-azure-env.png 2x" sizes=auto alt="Cloud Environment" height=2153 width=5751></a><figcaption class=image-caption>Cloud Environment</figcaption></figure></p><p>Colocation Data Centers like <a href=https://www.equinix.com/ target=_blank rel="noopener noreferrer">Equinix</a> or <a href=https://www.megaport.com/ target=_blank rel="noopener noreferrer">Megaport</a> are being used more frequently as demand for cloud services increase. We will need to make some changes to a few physical <a href=https://www.cisco.com/c/en/us/products/routers/asr-1002-hx-router/index.html target=_blank rel="noopener noreferrer">Cisco ASRs</a>, so packets can route.</p><p><figure><a class=lightgallery href=/posts/2020/automating-cloud-ipam/cloud-env-colo.png title="Cloud Environment - CoLo" data-thumbnail=/posts/2020/automating-cloud-ipam/cloud-env-colo.png data-sub-html="<h2>Cloud</h2><p>Cloud Environment - CoLo</p>"><img loading=lazy src=/posts/2020/automating-cloud-ipam/cloud-env-colo.png srcset="/posts/2020/automating-cloud-ipam/cloud-env-colo.png, /posts/2020/automating-cloud-ipam/cloud-env-colo.png 1.5x, /posts/2020/automating-cloud-ipam/cloud-env-colo.png 2x" sizes=auto alt="Cloud Environment - CoLo" height=902 width=2976></a><figcaption class=image-caption>Cloud</figcaption></figure></p><h2 id=design-drives-automation class=headerLink><a href=#design-drives-automation class=header-mark></a>Design Drives Automation</h2><p>Thinking through a given design is a crucial element for how you approach the automation. If our goal is <em>end-to-end</em> network automation at scale, that means we must automate across multiple vendors and environments.</p><h3 id=standard-workflows class=headerLink><a href=#standard-workflows class=header-mark></a>Standard Workflows</h3><p>To automate both the foundational (shared) and service-oriented (app-specific) components, leveraging two distinct workflows makes sense.</p><p><figure><a class=lightgallery href=/posts/2020/automating-cloud-ipam/standard-workflows.png title="Standard Workflows" data-thumbnail=/posts/2020/automating-cloud-ipam/standard-workflows.png data-sub-html="<h2>Standard Workflows</h2><p>Standard Workflows</p>"><img loading=lazy src=/posts/2020/automating-cloud-ipam/standard-workflows.png srcset="/posts/2020/automating-cloud-ipam/standard-workflows.png, /posts/2020/automating-cloud-ipam/standard-workflows.png 1.5x, /posts/2020/automating-cloud-ipam/standard-workflows.png 2x" sizes=auto alt="Standard Workflows" height=1296 width=2451></a><figcaption class=image-caption>Standard Workflows</figcaption></figure></p><h3 id=a-scalable-tagging-system class=headerLink><a href=#a-scalable-tagging-system class=header-mark></a>A Scalable Tagging System</h3><p>If you want to do cloud right, cost governance should be in your considerations. This means a well-designed and consistently applied tagging convention, which compliments lifecycle management, automation, and visibility in reporting. In treating our pets like cattle, we need a <em>source of truth</em> with standardized identification across all networking components.</p><p><figure><a class=lightgallery href=/posts/2020/automating-cloud-ipam/resource-tagging.png title="Resource Tagging" data-thumbnail=/posts/2020/automating-cloud-ipam/resource-tagging.png data-sub-html="<h2>Resource Tagging</h2><p>Resource Tagging</p>"><img loading=lazy src=/posts/2020/automating-cloud-ipam/resource-tagging.png srcset="/posts/2020/automating-cloud-ipam/resource-tagging.png, /posts/2020/automating-cloud-ipam/resource-tagging.png 1.5x, /posts/2020/automating-cloud-ipam/resource-tagging.png 2x" sizes=auto alt="Resource Tagging" height=2059 width=2816></a><figcaption class=image-caption>Resource Tagging</figcaption></figure></p><h3 id=touchpoints class=headerLink><a href=#touchpoints class=header-mark></a>Touchpoints</h3><p>Between both of our workflows, there are numerous touchpoints:</p><ul><li><a href=https://docs.ansible.com/ansible/latest/plugins/connection/network_cli.html target=_blank rel="noopener noreferrer">network_cli</a> for traditional networking</li><li><a href=https://docs.ansible.com/ansible/latest/modules/list_of_cloud_modules.html#azure target=_blank rel="noopener noreferrer">Ansible Cloud Modules</a> via <a href=https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/overview target=_blank rel="noopener noreferrer">Azure Resource Manager</a></li><li><a href=https://galaxy.ansible.com/netbox/netbox target=_blank rel="noopener noreferrer">Netbox Collection</a> leveraging the Netbox API</li></ul><p><figure><a class=lightgallery href=/posts/2020/automating-cloud-ipam/touchpoints.png title=Touchpoints data-thumbnail=/posts/2020/automating-cloud-ipam/touchpoints.png data-sub-html="<h2>Touchpoints</h2><p>Touchpoints</p>"><img loading=lazy src=/posts/2020/automating-cloud-ipam/touchpoints.png srcset="/posts/2020/automating-cloud-ipam/touchpoints.png, /posts/2020/automating-cloud-ipam/touchpoints.png 1.5x, /posts/2020/automating-cloud-ipam/touchpoints.png 2x" sizes=auto alt=Touchpoints height=1759 width=2843></a><figcaption class=image-caption>Touchpoints</figcaption></figure></p><h2 id=breaking-down-the-logic class=headerLink><a href=#breaking-down-the-logic class=header-mark></a>Breaking Down The Logic</h2><p>A great benefit of using <a href=https://www.ansible.com/ target=_blank rel="noopener noreferrer">Ansible</a> is flexibility. This can also cause significant confusion as there are many ways in which we can structure things. It is beneficial to understand the structure, logic flow, and inheritance.</p><h3 id=project-structure class=headerLink><a href=#project-structure class=header-mark></a>Project Structure</h3><p>Thinking through your project structure can make future work more manageable. The following guide - <a href=https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html target=_blank rel="noopener noreferrer">Best Practices - Content Organization</a> in Ansible&rsquo;s documentation is a good starting point. However, this is not a one size fits all scenario, and experimenting, reevaluating, and tweaking will probably be necessary. The following approach has served me well in the past.</p><p><figure><a class=lightgallery href=/posts/2020/automating-cloud-ipam/project-structure.png title="Project Structure" data-thumbnail=/posts/2020/automating-cloud-ipam/project-structure.png data-sub-html="<h2>Project Structure</h2><p>Project Structure</p>"><img loading=lazy src=/posts/2020/automating-cloud-ipam/project-structure.png srcset="/posts/2020/automating-cloud-ipam/project-structure.png, /posts/2020/automating-cloud-ipam/project-structure.png 1.5x, /posts/2020/automating-cloud-ipam/project-structure.png 2x" sizes=auto alt="Project Structure" height=1489 width=2421></a><figcaption class=image-caption>Project Structure</figcaption></figure></p><h3 id=ansible-collections class=headerLink><a href=#ansible-collections class=header-mark></a>Ansible Collections</h3><p><a href=https://www.ansible.com/products/content-collections target=_blank rel="noopener noreferrer">Ansible Collections</a> are pretty slick. My only recommendation here is, manage your collections with a <em>requirements.yml</em> file. When it comes to testing new versions of a collection, all you need do is create a new git branch, set the new version in your <em>requirements.yml</em> file, and point Tower to this branch. Ansible has documented collections usage pretty thoroughly <a href=https://docs.ansible.com/ansible/latest/user_guide/collections_using.html target=_blank rel="noopener noreferrer">here.</a></p><p><a href=https://github.com/wcollins/ansible-cloud-ipam/blob/master/collections/requirements.yml target=_blank rel="noopener noreferrer"><strong>ansible-cloud-ipam/collections/requirements.yml</strong></a>
<script type=application/javascript src=https://gist.github.com/wcollins/de3a9667cfba0d4fc371e73288bd04a1.js></script></p><blockquote><p>I would stress never pulling down collections from Galaxy and committing them directly into the source control repository for your project. Friends do not let friends engage in this type of behavior!</p></blockquote><h3 id=high-level-plays class=headerLink><a href=#high-level-plays class=header-mark></a>High-Level Plays</h3><p>The playbooks sitting in our root project folder are pretty simple. They are primarily used as the <em>entry</em> point for Ansible and execute based on a specific condition.</p><p><a href=https://github.com/wcollins/ansible-cloud-ipam/blob/master/play.azure_snet_add.yml target=_blank rel="noopener noreferrer"><strong>ansible-cloud-ipam/play.azure_snet_add.yml</strong></a>
<script type=application/javascript src=https://gist.github.com/wcollins/dba6213c1ff162da990f2f7c10ad5dcf.js></script></p><h3 id=functional-roles class=headerLink><a href=#functional-roles class=header-mark></a>Functional Roles</h3><p>Roles for this demo are organized by either a given platform or OS type. Each role&rsquo;s main file will include specific <em>tasks</em> to use based on the condition defined in the root level play.</p><p><a href=https://github.com/wcollins/ansible-cloud-ipam/blob/master/roles/netbox/tasks/main.yml target=_blank rel="noopener noreferrer"><strong>ansible-cloud-ipam/roles/netbox/tasks/main.yml</strong></a>
<script type=application/javascript src=https://gist.github.com/wcollins/fb49545caa817c1d00381ed8aefea64f.js></script></p><h3 id=purpose-built-tasks class=headerLink><a href=#purpose-built-tasks class=header-mark></a>Purpose Built Tasks</h3><p>The actual logic is handled inside a given role&rsquo;s tasks. Each task is purpose-built and does a very intentional thing. Also, the idea is to keep things DRY <em>(Don&rsquo;t repeat yourself)</em> so that we can easily reuse things. This means we don&rsquo;t want to set values here statically. The smaller a thing is, the less it does. If something does less, it makes it easier to repeat.</p><p><a href=https://github.com/wcollins/ansible-cloud-ipam/blob/master/roles/netbox/tasks/task.netbox_reserve_prefix_snet.yml target=_blank rel="noopener noreferrer"><strong>ansible-cloud-ipam/roles/netbox/tasks/task.netbox_reserve_prefix_snet.yml</strong></a>
<script type=application/javascript src=https://gist.github.com/wcollins/c81b3ce73d8eb3ce61f38eabd6baeda4.js></script></p><h3 id=the-physical-network class=headerLink><a href=#the-physical-network class=header-mark></a>The Physical Network</h3><p>Out of the three platforms we have interacted with here, the <a href=https://www.cisco.com/c/en/us/products/routers/asr-1002-hx-router/index.html target=_blank rel="noopener noreferrer">Cisco ASR</a> is the only one that isn&rsquo;t <em>API</em> driven. For automating this beauty, I&rsquo;ll be using the <a href=https://docs.ansible.com/ansible/latest/modules/ios_config_module.html target=_blank rel="noopener noreferrer">ios_config</a> module for configuration.</p><p>There are more modern ways to do this today, but this is probably the reality for most in practice. This is a straightforward use case, so this type of execution serves its purpose for a demo&rsquo;s scope. Each time the <em>Service Workflow</em> is run, the subnet it reserves will be appended to a <em>prefix-list</em> living on the <em>ASR</em>.</p><p>In a <em>real world</em> cloud scenario, this <em>prefix-list</em> could be used to identify and filter traffic. It could then be used inside a <em>route-map</em> to enable and enforce policy criteria beyond the <em>routing table</em>. When doing BGP to the cloud, this can be important as you may want to enforce specific policies on specific neighbors to particular clouds.</p><p><a href=https://github.com/wcollins/ansible-cloud-ipam/blob/master/roles/cisco-ios/tasks/task.ios_prefix_list_append.yml target=_blank rel="noopener noreferrer"><strong>ansible-cloud-ipam/roles/cisco-ios/tasks/task.ios_prefix_list_append.yml</strong></a>
<script type=application/javascript src=https://gist.github.com/wcollins/1ea22c02e95e8641678ee04b760091ec.js></script></p><h2 id=putting-it-all-together class=headerLink><a href=#putting-it-all-together class=header-mark></a>Putting It All Together</h2><p>Ansible Tower offers two flavors of templates. <a href=https://docs.ansible.com/ansible-tower/latest/html/userguide/job_templates.html target=_blank rel="noopener noreferrer">Job Templates</a> are used to execute a single task many times, while <a href=https://docs.ansible.com/ansible-tower/latest/html/userguide/workflow_templates.html target=_blank rel="noopener noreferrer">Workflow Templates</a> stitch together multiple <em>Job Templates</em>.</p><p>The value here aims at getting the same outcome that your typical <em>Build/Release</em> pipelines would offer for <em>Infrastructure as Code</em>. When thinking of <em>infrastructure as Code</em>, I generally think <em>immutability</em> and cloud <em>exclusivity</em>.</p><p>In my opinion, this approach lends itself more to remaining flexible and accommodating for a multitude of disparate and traditional infrastructure while also providing the ability to integrate with new technologies.</p><p><figure><a class=lightgallery href=/posts/2020/automating-cloud-ipam/putting-it-together.png title=Templates data-thumbnail=/posts/2020/automating-cloud-ipam/putting-it-together.png data-sub-html="<h2>Templates</h2><p>Templates</p>"><img loading=lazy src=/posts/2020/automating-cloud-ipam/putting-it-together.png srcset="/posts/2020/automating-cloud-ipam/putting-it-together.png, /posts/2020/automating-cloud-ipam/putting-it-together.png 1.5x, /posts/2020/automating-cloud-ipam/putting-it-together.png 2x" sizes=auto alt=Templates height=1369 width=3167></a><figcaption class=image-caption>Templates</figcaption></figure></p><h3 id=job-templates class=headerLink><a href=#job-templates class=header-mark></a>Job Templates</h3><p>In the spirit of building for repeatability, I created <em>Job Templates</em> for each unique task. This allows me to reuse them over time in new <em>Workflow Templates</em> as new use cases present themselves.</p><p><figure><a class=lightgallery href=/posts/2020/automating-cloud-ipam/create-job-template.gif title="Create Job Template" data-thumbnail=/posts/2020/automating-cloud-ipam/create-job-template.gif data-sub-html="<h2>Job Template</h2><p>Create Job Template</p>"><img loading=lazy src=/posts/2020/automating-cloud-ipam/create-job-template.gif srcset="/posts/2020/automating-cloud-ipam/create-job-template.gif, /posts/2020/automating-cloud-ipam/create-job-template.gif 1.5x, /posts/2020/automating-cloud-ipam/create-job-template.gif 2x" sizes=auto alt="Create Job Template" height=1001 width=1948></a><figcaption class=image-caption>Job Template</figcaption></figure></p><h3 id=workflow-templates class=headerLink><a href=#workflow-templates class=header-mark></a>Workflow Templates</h3><p>I then assembled my two <em>Workflow Templates</em> outlined above. The <em>Base Workflow</em> in practice would be run far less frequently than the <em>Service Workflow</em>.</p><h3 id=workflow-visualizer class=headerLink><a href=#workflow-visualizer class=header-mark></a>Workflow Visualizer</h3><p>Stitching your workflow together is pretty simple with Tower&rsquo;s <em>workflow visualizer</em>. Once you create a blanket workflow, you can add and arrange jobs.</p><p><figure><a class=lightgallery href=/posts/2020/automating-cloud-ipam/workflow-visualizer.gif title="Workflow Visualizer" data-thumbnail=/posts/2020/automating-cloud-ipam/workflow-visualizer.gif data-sub-html="<h2>Workflow Visualizer</h2><p>Workflow Visualizer</p>"><img loading=lazy src=/posts/2020/automating-cloud-ipam/workflow-visualizer.gif srcset="/posts/2020/automating-cloud-ipam/workflow-visualizer.gif, /posts/2020/automating-cloud-ipam/workflow-visualizer.gif 1.5x, /posts/2020/automating-cloud-ipam/workflow-visualizer.gif 2x" sizes=auto alt="Workflow Visualizer" height=1080 width=2084></a><figcaption class=image-caption>Workflow Visualizer</figcaption></figure></p><h3 id=using-surveys class=headerLink><a href=#using-surveys class=header-mark></a>Using Surveys</h3><p><a href=https://docs.ansible.com/ansible-tower/latest/html/userguide/job_templates.html#surveys target=_blank rel="noopener noreferrer">Surveys</a> are a great way to populate variables at runtime interactively. Once a <em>source of truth</em> in a given data domain is populated, and the logic is more mature, this will probably be used less.</p><p><figure><a class=lightgallery href=/posts/2020/automating-cloud-ipam/using-surveys.gif title="Using Surveys" data-thumbnail=/posts/2020/automating-cloud-ipam/using-surveys.gif data-sub-html="<h2>Surveys</h2><p>Using Surveys</p>"><img loading=lazy src=/posts/2020/automating-cloud-ipam/using-surveys.gif srcset="/posts/2020/automating-cloud-ipam/using-surveys.gif, /posts/2020/automating-cloud-ipam/using-surveys.gif 1.5x, /posts/2020/automating-cloud-ipam/using-surveys.gif 2x" sizes=auto alt="Using Surveys" height=889 width=2082></a><figcaption class=image-caption>Surveys</figcaption></figure></p><h3 id=workflows-in-action class=headerLink><a href=#workflows-in-action class=header-mark></a>Workflows In Action</h3><p>Now that our workflow is populated with the right variables let&rsquo;s take it for a spin!</p><p><figure><a class=lightgallery href=/posts/2020/automating-cloud-ipam/running-workflows.gif title="Running Workflows" data-thumbnail=/posts/2020/automating-cloud-ipam/running-workflows.gif data-sub-html="<h2>Running Workflows</h2><p>Running Workflows</p>"><img loading=lazy src=/posts/2020/automating-cloud-ipam/running-workflows.gif srcset="/posts/2020/automating-cloud-ipam/running-workflows.gif, /posts/2020/automating-cloud-ipam/running-workflows.gif 1.5x, /posts/2020/automating-cloud-ipam/running-workflows.gif 2x" sizes=auto alt="Running Workflows" height=388 width=1758></a><figcaption class=image-caption>Running Workflows</figcaption></figure></p><h3 id=a-little-manual-validation class=headerLink><a href=#a-little-manual-validation class=header-mark></a>A Little Manual Validation</h3><p>Purely for the sake of delightful visuals, let&rsquo;s validate a few things.</p><p><strong>Netbox Prefix Reservation:</strong>
We can see here that the next available prefix was reserved, configuration criteria are correct, and our enforced tags are in place.</p><p><figure><a class=lightgallery href=/posts/2020/automating-cloud-ipam/validate-netbox.gif title="Netbox Validation" data-thumbnail=/posts/2020/automating-cloud-ipam/validate-netbox.gif data-sub-html="<h2>Netbox Validation</h2><p>Netbox Validation</p>"><img loading=lazy src=/posts/2020/automating-cloud-ipam/validate-netbox.gif srcset="/posts/2020/automating-cloud-ipam/validate-netbox.gif, /posts/2020/automating-cloud-ipam/validate-netbox.gif 1.5x, /posts/2020/automating-cloud-ipam/validate-netbox.gif 2x" sizes=auto alt="Netbox Validation" height=922 width=1580></a><figcaption class=image-caption>Netbox Validation</figcaption></figure></p><p><strong>Cisco ASR 1002-HX Configuration:</strong>
The prefix reserved above has now been added to the <em>cloud-allowed-prefixes</em> list on our router. If the list does not exist, the job will create it. From there, any new prefixes reserved will then be appended.</p><p><figure><a class=lightgallery href=/posts/2020/automating-cloud-ipam/validate-prefix.gif title="Cisco ASR 1002-HX Validation" data-thumbnail=/posts/2020/automating-cloud-ipam/validate-prefix.gif data-sub-html="<h2>ASR Validation</h2><p>Cisco ASR 1002-HX Validation</p>"><img loading=lazy src=/posts/2020/automating-cloud-ipam/validate-prefix.gif srcset="/posts/2020/automating-cloud-ipam/validate-prefix.gif, /posts/2020/automating-cloud-ipam/validate-prefix.gif 1.5x, /posts/2020/automating-cloud-ipam/validate-prefix.gif 2x" sizes=auto alt="Cisco ASR 1002-HX Validation" height=214 width=1000></a><figcaption class=image-caption>ASR Validation</figcaption></figure></p><h2 id=conclusion class=headerLink><a href=#conclusion class=header-mark></a>Conclusion</h2><p>Building a logical way for developers to consume <em>IPAM</em> at the speed of cloud is <strong><em>WINNING!</em></strong> Remember, go <strong>fast</strong>, but go <strong>responsibly!</strong></p><p><figure><a class=lightgallery href=/posts/2020/automating-cloud-ipam/go-fast.gif title="Go Fast!" data-thumbnail=/posts/2020/automating-cloud-ipam/go-fast.gif data-sub-html="<h2>Go Fast!</h2><p>Go Fast!</p>"><img loading=lazy src=/posts/2020/automating-cloud-ipam/go-fast.gif srcset="/posts/2020/automating-cloud-ipam/go-fast.gif, /posts/2020/automating-cloud-ipam/go-fast.gif 1.5x, /posts/2020/automating-cloud-ipam/go-fast.gif 2x" sizes=auto alt="Go Fast!" height=1107 width=2547></a><figcaption class=image-caption>Go Fast!</figcaption></figure></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 13 October 2020</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-mardown href=/posts/2020/automating-cloud-ipam/index.md target=_blank rel="noopener noreferrer">Read markdown</a></span></div><div class=post-info-share></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/ansible/>ansible</a>,&nbsp;<a href=/tags/ansiblefest/>ansiblefest</a>,&nbsp;<a href=/tags/azure/>azure</a>,&nbsp;<a href=/tags/ipam/>ipam</a>,&nbsp;<a href=/tags/netbox/>netbox</a>,&nbsp;<a href=/tags/cisco-asr/>cisco asr</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/2020/alkira-multicloud-networking/ class=prev rel=prev title="Multi-Cloud Networking With Alkira"><i class="fas fa-angle-left fa-fw"></i>Multi-Cloud Networking With Alkira</a>
<a href=/posts/2021/cloud-security-and-azure-private-link/ class=next rel=next title="Cloud Security And Azure Private Link">Cloud Security And Azure Private Link<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2019 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank rel="noopener noreferrer">William Collins</a></span></div><div class=footer-line></div><div class=footer-line></div></div></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},search:{distance:null,findAllMatches:null,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:null,ignoreLocation:null,isCaseSensitive:null,location:null,maxResultLength:10,minMatchCharLength:null,noResultsFound:"No results found",snippetLength:30,threshold:null,type:"fuse",useExtendedSearch:null}}</script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9QKVT40M3H")</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-9QKVT40M3H" async></script></div></body></html>