<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>Importing Infrastructure With Azure Terrafy - </title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta http-equiv=cache-control content="no-transform">
<meta http-equiv=cache-control content="no-siteapp">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=author content="William Collins"><meta name=description content="Anyone that has worked in tech knows that building greenfield is much easier than dragging along brownfield environments through a roller-coaster they aren&amp;rsquo;t ready for. Tools like Terraform make infrastructure-as-code a breeze, but what about all that infrastructure you already have provisioned? April Edwards, Cloud Advocate at Microsoft, recently posted a blog about Azure Terrafy, a new tool in preview which aims to simplify the process. You can find the original blog here.">
<meta name=google-site-verification content="FSCEdJZD7nAoKk16ak20hRMKNBvXlnHAU0PBBDZy5DU">
<meta name=generator content="Hugo 0.87.0 with theme even">
<link rel=canonical href=http://wcollins.io/post/2022/importing-infrastructure-with-azure-terrafy/>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/manifest.json>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<link href=/sass/main.min.8c3cbcb0324c2bb4875ceccba4007cbad4b4ac8377f33af9953c3e7684534a50.css rel=stylesheet>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous>
<meta property="og:title" content="Importing Infrastructure With Azure Terrafy">
<meta property="og:description" content="Anyone that has worked in tech knows that building greenfield is much easier than dragging along brownfield environments through a roller-coaster they aren&rsquo;t ready for. Tools like Terraform make infrastructure-as-code a breeze, but what about all that infrastructure you already have provisioned? April Edwards, Cloud Advocate at Microsoft, recently posted a blog about Azure Terrafy, a new tool in preview which aims to simplify the process. You can find the original blog here.">
<meta property="og:type" content="article">
<meta property="og:url" content="http://wcollins.io/post/2022/importing-infrastructure-with-azure-terrafy/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2022-05-16T08:01:11-04:00">
<meta property="article:modified_time" content="2022-05-16T08:01:11-04:00">
<meta itemprop=name content="Importing Infrastructure With Azure Terrafy">
<meta itemprop=description content="Anyone that has worked in tech knows that building greenfield is much easier than dragging along brownfield environments through a roller-coaster they aren&rsquo;t ready for. Tools like Terraform make infrastructure-as-code a breeze, but what about all that infrastructure you already have provisioned? April Edwards, Cloud Advocate at Microsoft, recently posted a blog about Azure Terrafy, a new tool in preview which aims to simplify the process. You can find the original blog here."><meta itemprop=datePublished content="2022-05-16T08:01:11-04:00">
<meta itemprop=dateModified content="2022-05-16T08:01:11-04:00">
<meta itemprop=wordCount content="582">
<meta itemprop=keywords content="azure,infrastructure-as-code,terraform,terrafy,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Importing Infrastructure With Azure Terrafy">
<meta name=twitter:description content="Anyone that has worked in tech knows that building greenfield is much easier than dragging along brownfield environments through a roller-coaster they aren&rsquo;t ready for. Tools like Terraform make infrastructure-as-code a breeze, but what about all that infrastructure you already have provisioned? April Edwards, Cloud Advocate at Microsoft, recently posted a blog about Azure Terrafy, a new tool in preview which aims to simplify the process. You can find the original blog here."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo></a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<a href=/>
<li class=mobile-menu-item>Home</li>
</a><a href=/about/>
<li class=mobile-menu-item>About</li>
</a><a href=/post/>
<li class=mobile-menu-item>Archives</li>
</a><a href=/tags/>
<li class=mobile-menu-item>Tags</li>
</a><a href=/categories/>
<li class=mobile-menu-item>Categories</li>
</a>
</ul>
</nav>
<div class=container id=mobile-panel>
<header id=header class=header>
<div class=logo-wrapper>
<a href=/ class=logo></a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=/>Home</a>
</li><li class=menu-item>
<a class=menu-item-link href=/about/>About</a>
</li><li class=menu-item>
<a class=menu-item-link href=/post/>Archives</a>
</li><li class=menu-item>
<a class=menu-item-link href=/tags/>Tags</a>
</li><li class=menu-item>
<a class=menu-item-link href=/categories/>Categories</a>
</li>
</ul>
</nav>
</header>
<main id=main class=main>
<div class=content-wrapper>
<div id=content class=content>
<article class=post>
<header class=post-header>
<h1 class=post-title>Importing Infrastructure With Azure Terrafy</h1>
<div class=post-meta>
<span class=post-time> May 16, 2022 </span>
<div class=post-category>
<a href=/categories/automation/> automation </a>
<a href=/categories/cloud/> cloud </a>
<a href=/categories/tools/> tools </a>
</div>
<span class=more-meta> 582 words </span>
<span class=more-meta> 3 mins read </span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title>Contents</h2>
<div class=post-toc-content>
<nav id=TableOfContents>
<ul>
<li>
<ul>
<li><a href=#installing-terrafy>Installing Terrafy</a></li>
<li><a href=#building-some-infra>Building some Infra</a></li>
<li><a href=#running-terrafy>Running Terrafy</a></li>
<li><a href=#was-it-successful>Was it Successful?</a></li>
<li><a href=#some-thoughts>Some Thoughts</a>
<ul>
<li><a href=#more-organization>More Organization</a></li>
</ul>
</li>
<li><a href=#summary>Summary</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
<div class=post-content>
<p>Anyone that has worked in <em>tech</em> knows that building <em>greenfield</em> is much easier than dragging along <em>brownfield</em> environments through a roller-coaster they aren&rsquo;t ready for. Tools like <a href=https://terraform.io>Terraform</a> make <em>infrastructure-as-code</em> a breeze, but what about all that infrastructure you already have provisioned? April Edwards, Cloud Advocate at Microsoft, recently posted a blog about <a href=https://github.com/azure/aztfy>Azure Terrafy</a>, a new tool in preview which aims to simplify the process. You can find the original blog <a href="https://techcommunity.microsoft.com/t5/itops-talk-blog/azure-terrafy-import-your-existing-azure-infrastructure-into/ba-p/3357653/WT.mc_id=modinfra-566685-apedward">here</a>. Let&rsquo;s take it for a spin!</p>
<p><img src=/images/2022/importing-infrastructure-with-azure-terrafy/intro.png alt=Intro></p>
<div class="admonition question"><p class=admonition-title>Can't you already import resources into Terraform state?</p>
<p><a href=https://www.terraform.io/cli/import/usage>Terraform Import</a> enables the importing of infrastructure today, but this only imports one resource at a time, and it&rsquo;s on you to build the configuration files. Sounds time-consuming, right? When you are in the process of learning Terraform, having a tool that can import <em>brownfield</em> environments into <em>state</em> while also generating the <a href=https://www.terraform.io/language/syntax/configuration>HCL files</a>, is extremely useful.</p>
</div>
<h2 id=installing-terrafy>Installing Terrafy</h2>
<p>I installed it via <strong>go install github.com/Azure/aztfy@latest</strong>.</p>
<p><img src=/images/2022/importing-infrastructure-with-azure-terrafy/install-terrafy.gif alt="Install Terrafy"></p>
<h2 id=building-some-infra>Building some Infra</h2>
<p>To kick off this little experiment, I will build some infrastructure in Azure using Terraform and then create a different project directory to test <em>Terrafy</em> in. If things go south, I don&rsquo;t have to remove everything manually.</p>
<p><strong>main.tf</strong>
<script type=application/javascript src=https://gist.github.com/wcollins/02ebb6d407e038095f4c4104fa8b169e.js></script>
</p>
<h2 id=running-terrafy>Running Terrafy</h2>
<p>I created an empty directory called <strong>terrafy-test</strong> for this exercise. Before running <em>Terrafy</em>, make sure <a href=https://docs.microsoft.com/en-us/cli/azure/install-azure-cli>azure-cli</a> is installed and authenticated. If your running on macOS and use <a href=https://brew.sh/>Homebrew</a>, you can run <strong>brew update && brew install azure-cli</strong> and then <strong>az login</strong>.</p>
<p><img src=/images/2022/importing-infrastructure-with-azure-terrafy/run-terrafy.gif alt="Run Terrafy"></p>
<div class="admonition danger"><p class=admonition-title>Missing Resources</p>
<p>Like a boss, I ran with defaults and didn&rsquo;t bother reading any of the well-crafted <a href=https://github.com/azure/aztfy#readme>README</a>. Most of the resources were translated fine, but I noticed the <em>virtual machines</em> and <em>storage accounts</em> didn&rsquo;t make it. When going through the setup, you will be able to cycle through and view all the resources available to import. If you see <strong>(Skip)</strong>, that resource will indeed get skipped unless you update the resource type accordingly.</p>
</div>
<h2 id=was-it-successful>Was it Successful?</h2>
<p>Let&rsquo;s test a few things before we ride off into the sunset. I did a <strong>terraform plan -refresh only</strong>, and also updated some resources, and everything looks good!</p>
<p><img src=/images/2022/importing-infrastructure-with-azure-terrafy/plan-refresh.gif alt="Plan Refresh"></p>
<h2 id=some-thoughts>Some Thoughts</h2>
<p>This is a great tool, especially in learning and adoption of <em>infrastructure-as-code</em>. The <em>import</em> process is scoped at the <a href=https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/overview>resource group</a> level, which makes a lot of sense. <a href="https://docs.microsoft.com/en-us/microsoft-365/enterprise/subscriptions-licenses-accounts-and-tenants-for-microsoft-cloud-offerings?view=o365-worldwide#subscriptions">Subscriptions</a> would be the next level up, and that might get too messy. When <em>Terrafy</em> generates the <em>infra-as-code</em> files, it builds a <strong>provider.tf</strong> to source the <em>azurerm</em> details, and all the other configuration is generated in a monolithic <strong>main.tf</strong> file. This is the layout here:</p>
<p><img src=/images/2022/importing-infrastructure-with-azure-terrafy/output.png alt="Configuration Output"></p>
<h3 id=more-organization>More Organization</h3>
<p>With <em>infra-as-code</em>, there is no easy button. To make things work at scale, things have to be organized. As a starting point, it would be neat to see <em>Terrafy</em> do more organization. Even something simple like breaking down infra into separate categories would be helpful.</p>
<p>An example of this would be taking resources like <em>localNetworkGateways</em>, <em>networkSecurityGroups</em>, and <em>virtualNetworks</em> and putting them into a separate file called <strong>network.tf</strong> as they all fall under <strong>Microsoft.Network</strong> when drilling down through <em>azurerm</em>.</p>
<p>Virtual Machines and all compute-related components would fall under <strong>Microsoft.Compute</strong> and would be in a different file called <strong>compute.tf</strong>. Organizing things in categories like this would make it easy to sift through larger imports.</p>
<h2 id=summary>Summary</h2>
<p><em>Terrafy</em> is a great way to bring existing <em>infrastructure</em> into Terraform state. Installation and usage are simple, and the documentation is good. I think this tool will gain enough momentum that new features will come quickly, hopefully on the organization side. To learn more, visit <a href=https://github.com/azure/aztfy>the GitHub page</a>. Happy building!</p>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=/tags/azure/>azure</a>
<a href=/tags/infrastructure-as-code/>infrastructure-as-code</a>
<a href=/tags/terraform/>terraform</a>
<a href=/tags/terrafy/>terrafy</a>
</div>
<nav class=post-nav>
<a class=next href=/post/2022/are-microservices-better-than-monoliths/>
<span class="next-text nav-default">Are Microservices Better Than Monoliths?</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i>
</a>
</nav>
</footer>
</article>
</div>
</div>
</main>
<footer id=footer class=footer>
<div class=social-links>
<a href=https://twitter.com/wcollins502/ class="iconfont icon-twitter" title=twitter></a>
<a href=https://www.linkedin.com/in/william-collins/ class="iconfont icon-linkedin" title=linkedin></a>
<a href=https://github.com/wcollins/ class="iconfont icon-github" title=github></a>
<a href=http://wcollins.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a>
</div>
<div class=copyright>
<span class=copyright-year>
&copy;
2020 -
2022<span class=division> | </span>
<span>William Collins</span>
</span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class="iconfont icon-up"></i>
</div>
</div>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.2517c0eb67172a0bae917de4af59b10ca2531411a009d4c0b82f5685259e5771.js></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','G-9QKVT40M3H','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</body>
</html>