<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Evolution of AWS Site-to-Site VPN - Part 1 -</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="William Collins"><meta name=description content="The necessity for protocols to keep communication secure has been around since the dawn of the internet. The first ever VPN was jointly developed by a vendor consortium (which included Microsoft) in 1996, and came in the form of Point-to-Point Tunneling Protocol. Although many are skeptical about the value of VPNs in 2022 and beyond, customer consumption of cloud provider VPN services have paved the way for additional features and exponential scale."><meta name=google-site-verification content="FSCEdJZD7nAoKk16ak20hRMKNBvXlnHAU0PBBDZy5DU"><meta name=generator content="Hugo 0.101.0 with theme even"><link rel=canonical href=http://wcollins.io/post/2022/evolution-of-aws-site-to-site-vpn-part-1/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.8c3cbcb0324c2bb4875ceccba4007cbad4b4ac8377f33af9953c3e7684534a50.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="Evolution of AWS Site-to-Site VPN - Part 1"><meta property="og:description" content="The necessity for protocols to keep communication secure has been around since the dawn of the internet. The first ever VPN was jointly developed by a vendor consortium (which included Microsoft) in 1996, and came in the form of Point-to-Point Tunneling Protocol. Although many are skeptical about the value of VPNs in 2022 and beyond, customer consumption of cloud provider VPN services have paved the way for additional features and exponential scale."><meta property="og:type" content="article"><meta property="og:url" content="http://wcollins.io/post/2022/evolution-of-aws-site-to-site-vpn-part-1/"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-11-22T08:15:58-05:00"><meta property="article:modified_time" content="2022-11-22T08:15:58-05:00"><meta itemprop=name content="Evolution of AWS Site-to-Site VPN - Part 1"><meta itemprop=description content="The necessity for protocols to keep communication secure has been around since the dawn of the internet. The first ever VPN was jointly developed by a vendor consortium (which included Microsoft) in 1996, and came in the form of Point-to-Point Tunneling Protocol. Although many are skeptical about the value of VPNs in 2022 and beyond, customer consumption of cloud provider VPN services have paved the way for additional features and exponential scale."><meta itemprop=datePublished content="2022-11-22T08:15:58-05:00"><meta itemprop=dateModified content="2022-11-22T08:15:58-05:00"><meta itemprop=wordCount content="611"><meta itemprop=keywords content="aws,awscommunitybuilders,site-to-site vpn,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Evolution of AWS Site-to-Site VPN - Part 1"><meta name=twitter:description content="The necessity for protocols to keep communication secure has been around since the dawn of the internet. The first ever VPN was jointly developed by a vendor consortium (which included Microsoft) in 1996, and came in the form of Point-to-Point Tunneling Protocol. Although many are skeptical about the value of VPNs in 2022 and beyond, customer consumption of cloud provider VPN services have paved the way for additional features and exponential scale."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo></a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/about/><li class=mobile-menu-item>About</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo></a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/about/>About</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Evolution of AWS Site-to-Site VPN - Part 1</h1><div class=post-meta><span class=post-time>November 22, 2022</span><div class=post-category><a href=/categories/cloud/>cloud</a>
<a href=/categories/cloud-networking/>cloud-networking</a>
<a href=/categories/network-design/>network-design</a></div><span class=more-meta>611 words</span>
<span class=more-meta>3 mins read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#my-first-experience>My First Experience</a><ul><li><a href=#making-it-highly-available>Making it Highly Available</a></li><li><a href=#growth-scale-and-operations>Growth, Scale, and Operations</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></li></ul></nav></div></div><div class=post-content><p>The necessity for <em>protocols</em> to keep communication secure has been around since the dawn of the internet. The first ever <em>VPN</em> was jointly developed by a vendor consortium <em>(which included Microsoft)</em> in <strong><em>1996</em></strong>, and came in the form of <a href=https://en.wikipedia.org/wiki/Point-to-Point_Tunneling_Protocol>Point-to-Point Tunneling Protocol</a>. Although many are skeptical about the value of VPNs in <em>2022</em> and beyond, customer consumption of cloud provider <em>VPN</em> services have paved the way for additional features and exponential scale.</p><p>What impact do innovations like <a href=https://aws.amazon.com/transit-gateway/>Transit Gateway</a> and <a href=https://docs.aws.amazon.com/vpn/latest/s2svpn/accelerated-vpn.html>Accelerated VPN Connections</a> have on design complexity, network performance, and operations? In this blog, I will look back at the first time I deployed a <em>site-to-site</em> VPN and then examine what is possible today when thinking through network design. This is going to be <em>two</em> parts.</p><h2 id=my-first-experience>My First Experience</h2><p><a href=https://docs.aws.amazon.com/vpn/latest/s2svpn/VPC_VPN.html>Site-to-Site VPN</a> in AWS is a fully managed and highly available service. This comes in the form of two endpoints on the AWS side (public IP addresses in different AZs per one VPN connection). This service is charged <em>hourly</em> per connection <em>(plus data transfer charges)</em>. My first experience connecting <em>on-premises</em> to <strong>AWS</strong> looked something like this:</p><p><img src=/images/2022/evolution-of-aws-site-to-site-vpn-part-1/first-vpn.png alt=first-vpn></p><p>This was long before the public cloud had disrupted enterprise infrastructure. In this case, we had a single <em>VPC</em> that required connectivity back to on-premises. Since the application being <em>developed</em> wasn&rsquo;t production, we set up a single <em>VPN</em> connection to a single physical router in the Data Center. This was easy work since, as <em>network engineers</em>, we pushed <em>VPNs</em> like <em>weights</em>. And we had an existing <em>B2B</em> process in place, so our paperwork + process was ready. Somewhere along the way, though, this application went into production.</p><h3 id=making-it-highly-available>Making it Highly Available</h3><p>Pre <em>Transit Gateway</em>, you would typically see a Virtual Private Gateway and VPN connection from each <em>VPC</em> back to <em>on-premises</em> devices. If you follow best practices and want the highest availability possible in this scenario, you will also have redundant devices on-premises. This means you would end up with <strong>2x VPN connections</strong>, which totals <strong>4x VPN tunnels</strong> per VPC. Once the application went past <em>QA</em>, to meet our requirements for <em>Tier 0</em> infrastructure, we needed <em>high availability</em>.</p><p><img src=/images/2022/evolution-of-aws-site-to-site-vpn-part-1/single-vpc.png alt=single-vpc></p><div class="admonition tip"><p class=admonition-title>Traffic Forwarding</p><p>One question I could always count on getting from <em>developers</em> when we would onboard this design was: &ldquo;Since we have four tunnels here, why can&rsquo;t we forward traffic on all of them?&rdquo; The simple answer is that you can override defaults and forward traffic across all tunnels <strong>to AWS</strong> from on-premises; however, the VGW will always select a single tunnel for return traffic.</p></div><h3 id=growth-scale-and-operations>Growth, Scale, and Operations</h3><p>At some point, <strong>Digital Transformation</strong> <em>(you may have heard of it)</em> caused crazy fast growth. And with that growth came more VPCs. And with those VPCs came the necessity for connectivity back to on-premises. Say we add just two additional VPCs using the above methodology, and we end up with <strong>6x VPN connections</strong>, bringing us to <strong>12x VPN tunnels</strong> to manage.</p><p><img src=/images/2022/evolution-of-aws-site-to-site-vpn-part-1/multi-vpc.gif alt=multi-vpc></p><div class="admonition danger"><p class=admonition-title>How much growth?</p><p>The above example is <strong>single region</strong> with only <strong>3 VPCs</strong>. The reality for many organizations using <em>AWS</em> is much larger. What would this design look like if we had <strong>50 VPCs</strong>? What happens when we need to include <em>multi-region</em> for DR capabilities? How does it impact operations when an application has performance issues, and the network is getting blamed?</p></div><h2 id=conclusion>Conclusion</h2><p>As we onboard more <em>VPCs</em>, it becomes apparent that the above design does not easily scale. Bandwidth is limited, tunnels increase exponentially, and operations will have limited success in diagnosing network problems <em>(or proving the network is not the problem)</em>. In <em>Part 2</em> we will dive into how <a href=https://aws.amazon.com/about-aws/whats-new/2018/11/introducing-aws-transit-gateway/>Transit Gateway</a> and <a href=https://docs.aws.amazon.com/vpn/latest/s2svpn/accelerated-vpn.html>Accelerated VPN Connections</a> take this from an operational <em>misstep</em> to an enterprise <em>success story</em>.</p></div><footer class=post-footer><div class=post-tags><a href=/tags/aws/>aws</a>
<a href=/tags/awscommunitybuilders/>awscommunitybuilders</a>
<a href=/tags/site-to-site-vpn/>site-to-site vpn</a></div><nav class=post-nav><a class=prev href=/post/2022/aws-reinvent-2022-recap/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">AWS re:Invent 2022 - Recap</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/post/2022/calculating-cost-like-a-devops-boss-with-infracost-and-aws/><span class="next-text nav-default">Calculating Cost Like a DevOps Boss with Infracost and AWS</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><script async src="https://www.googletagmanager.com/gtag/js?id=G-9QKVT40M3H"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9QKVT40M3H",{anonymize_ip:!1})}</script><footer id=footer class=footer><div class=social-links><a href=https://twitter.com/wcollins502/ class="iconfont icon-twitter" title=twitter></a>
<a href=https://www.linkedin.com/in/william-collins/ class="iconfont icon-linkedin" title=linkedin></a>
<a href=https://github.com/wcollins/ class="iconfont icon-github" title=github></a>
<a href=http://wcollins.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=copyright-year>&copy;
2020 -
2022<span class=division> |</span>
<span>William Collins</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.1c70606d1b733282f06230615f5561b5894924b6f9930ba2ab99cf1254f75a1a.js></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-9QKVT40M3H","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>