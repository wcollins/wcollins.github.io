<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Terraforming Alkira and Fortinet is Multicloud Bliss -</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="William Collins"><meta name=description content="There is a reason why enterprises prefer the best-of-breed approach to connect and secure their network and intellectual property. Alkira announced its integration with Fortinet at AWS re:Inforce in July, and this is a perfect example of the best in action. As anyone that reads my blog knows, I have an automation first approach to everything. Alkira&amp;rsquo;s Terraform Provider is Fortinet ready, so let&amp;rsquo;s take it for a spin!
Key Features This partnership comes packed with great features, including the seamless integration of FortiManager (which orchestrates the Fortinet Security Fabric), extending existing firewall zones into and across clouds with auto-mapping of zones-to-groups, and weathering traffic surges with auto-scaling."><meta name=google-site-verification content="FSCEdJZD7nAoKk16ak20hRMKNBvXlnHAU0PBBDZy5DU"><meta name=generator content="Hugo 0.101.0 with theme even"><link rel=canonical href=http://wcollins.io/post/2022/terraforming-alkira-and-fortinet-is-multicloud-bliss/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.8c3cbcb0324c2bb4875ceccba4007cbad4b4ac8377f33af9953c3e7684534a50.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="Terraforming Alkira and Fortinet is Multicloud Bliss"><meta property="og:description" content="There is a reason why enterprises prefer the best-of-breed approach to connect and secure their network and intellectual property. Alkira announced its integration with Fortinet at AWS re:Inforce in July, and this is a perfect example of the best in action. As anyone that reads my blog knows, I have an automation first approach to everything. Alkira&rsquo;s Terraform Provider is Fortinet ready, so let&rsquo;s take it for a spin!
Key Features This partnership comes packed with great features, including the seamless integration of FortiManager (which orchestrates the Fortinet Security Fabric), extending existing firewall zones into and across clouds with auto-mapping of zones-to-groups, and weathering traffic surges with auto-scaling."><meta property="og:type" content="article"><meta property="og:url" content="http://wcollins.io/post/2022/terraforming-alkira-and-fortinet-is-multicloud-bliss/"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-08-03T13:42:35-04:00"><meta property="article:modified_time" content="2022-08-03T13:42:35-04:00"><meta itemprop=name content="Terraforming Alkira and Fortinet is Multicloud Bliss"><meta itemprop=description content="There is a reason why enterprises prefer the best-of-breed approach to connect and secure their network and intellectual property. Alkira announced its integration with Fortinet at AWS re:Inforce in July, and this is a perfect example of the best in action. As anyone that reads my blog knows, I have an automation first approach to everything. Alkira&rsquo;s Terraform Provider is Fortinet ready, so let&rsquo;s take it for a spin!
Key Features This partnership comes packed with great features, including the seamless integration of FortiManager (which orchestrates the Fortinet Security Fabric), extending existing firewall zones into and across clouds with auto-mapping of zones-to-groups, and weathering traffic surges with auto-scaling."><meta itemprop=datePublished content="2022-08-03T13:42:35-04:00"><meta itemprop=dateModified content="2022-08-03T13:42:35-04:00"><meta itemprop=wordCount content="866"><meta itemprop=keywords content="alkira,fortinet,infrastructure-as-code,policy-as-code,terraform,segmentation,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Terraforming Alkira and Fortinet is Multicloud Bliss"><meta name=twitter:description content="There is a reason why enterprises prefer the best-of-breed approach to connect and secure their network and intellectual property. Alkira announced its integration with Fortinet at AWS re:Inforce in July, and this is a perfect example of the best in action. As anyone that reads my blog knows, I have an automation first approach to everything. Alkira&rsquo;s Terraform Provider is Fortinet ready, so let&rsquo;s take it for a spin!
Key Features This partnership comes packed with great features, including the seamless integration of FortiManager (which orchestrates the Fortinet Security Fabric), extending existing firewall zones into and across clouds with auto-mapping of zones-to-groups, and weathering traffic surges with auto-scaling."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo></a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/about/><li class=mobile-menu-item>About</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo></a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/about/>About</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Terraforming Alkira and Fortinet is Multicloud Bliss</h1><div class=post-meta><span class=post-time>August 3, 2022</span><div class=post-category><a href=/categories/automation/>automation</a>
<a href=/categories/cloud/>cloud</a>
<a href=/categories/cloud-networking/>cloud-networking</a>
<a href=/categories/cloud-security/>cloud-security</a>
<a href=/categories/multi-cloud/>multi-cloud</a>
<a href=/categories/netdevops/>netdevops</a>
<a href=/categories/netsecops/>netsecops</a></div><span class=more-meta>866 words</span>
<span class=more-meta>5 mins read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#key-features>Key Features</a></li><li><a href=#the-plan>The Plan</a><ul><li><a href=#existing-topology>Existing Topology</a></li><li><a href=#scoping-criteria>Scoping Criteria</a></li><li><a href=#policy-criteria>Policy Criteria</a></li></ul></li><li><a href=#lets-build>Let&rsquo;s Build!</a><ul><li><a href=#some-locals>Some Locals</a></li><li><a href=#fortinet-configuration>Fortinet Configuration</a></li><li><a href=#policy-configuration>Policy Configuration</a></li></ul></li><li><a href=#validation>Validation</a></li><li><a href=#conclusion>Conclusion</a></li></ul></li></ul></nav></div></div><div class=post-content><p>There is a reason why enterprises prefer the <em>best-of-breed</em> approach to connect and secure their network and intellectual property. <a href=https://www.alkira.com/blog/alkira-and-fortinet-partner-to-secure-cloud-area-networking-traffic/>Alkira announced its integration with Fortinet</a> at <strong>AWS re:Inforce</strong> in July, and this is a <em>perfect</em> example of <strong>the best</strong> in action. As anyone that reads my blog knows, I have an <strong>automation first</strong> approach to everything. <a href=https://registry.terraform.io/providers/alkiranet/alkira/latest/docs/resources/service_fortinet>Alkira&rsquo;s Terraform Provider is Fortinet ready</a>, so let&rsquo;s take it for a spin!</p><p><img src=/images/2022/terraforming-alkira-and-fortinet-is-multicloud-bliss/intro.png alt=Intro></p><h2 id=key-features>Key Features</h2><p>This partnership comes packed with great features, including the seamless integration of <a href="https://www.fortinet.com/products/management/fortimanager.html?utm_source=blog&utm_campaign=fortimanager-main-page">FortiManager</a> <em>(which orchestrates the Fortinet Security Fabric)</em>, extending existing firewall <em>zones</em> into and across clouds with <strong>auto-mapping</strong> of <em>zones-to-groups</em>, and weathering traffic surges with <strong>auto-scaling</strong>.</p><div class="admonition tip"><p class=admonition-title>Alkira and Firewall State</p><p>Coming from the <em>Data Center</em> world, configuring firewalls for <em>high-availability</em> has its challenges. Since firewalls are <em>stateful</em>, if traffic ingresses <strong>firewall-a</strong> and egresses <strong>firewall-b</strong>, you break state since <strong>firewall-b</strong> has no session. With Alkira, <strong>FortiGate</strong> instances run <em>active/active</em> and <em>traffic symmetry</em> is handled natively. Consistent hashing is inserted into the forwarding layer to detect failures and transition to available instances.</p></div><h2 id=the-plan>The Plan</h2><p>For this exercise, I decided to include a mix of <strong>Hybrid Multi-Cloud</strong> and <strong>Multi-Region</strong> to play with, and why not cross <em>continents</em> too? I already have an <em>SD-WAN</em> fabric extended into <strong>East US</strong> and <strong>Central EU</strong> regions along with an IPSEC tunnel. For <em>cloud</em>, I have several networks connected from <a href=https://aws.amazon.com/>AWS</a> and <a href=https://azure.microsoft.com/en-us/>Azure</a> with Multi-Cloud <a href=%5Bhttps://%5D(https://registry.terraform.io/providers/alkiranet/alkira/latest/docs/resources/connector_internet_exit)>Internet Exit</a>. This gives us plenty of options for selectively forwarding traffic to the <strong>FortiGates</strong> for <em>east/west</em>, <em>north/south</em>, and internet bound traffic.</p><h3 id=existing-topology>Existing Topology</h3><p><img src=/images/2022/terraforming-alkira-and-fortinet-is-multicloud-bliss/topology.png alt=Topology></p><h3 id=scoping-criteria>Scoping Criteria</h3><p>First, let&rsquo;s scope out the basics of <em>what</em> we want to deploy:</p><ul><li><em>FortiGates</em> running <a href=https://docs.fortinet.com/document/fortigate/7.0.3/fortios-release-notes/553516/change-log>FortiOS: 7.0.3</a> deployed in all regions</li><li>Register with <em>on-premises</em> <strong>FortiManager</strong></li><li><em>Minimum: 2 / Maximum: 4</em> auto-scaling configuration</li><li>Extend existing on-premises <em>FortiGate</em> zones across all clouds</li></ul><h3 id=policy-criteria>Policy Criteria</h3><p>Second, let&rsquo;s define what traffic we want to steer through the <strong>FortiGates</strong> and what should be left alone.</p><ul><li>Deny <em>any-to-any</em> by default</li><li>Non-Prod can talk to Non-Prod directly but must pass through a <em>FortiGate</em> when talking to Prod</li><li>Non-Prod can egress to the internet directly, but Prod must first pass through a <em>FortiGate</em></li><li>Partner can talk to migration cloud networks only but must first pass through a <em>FortiGate</em></li><li>Corporate can talk to <em>all</em> cloud networks but must first pass through a <em>FortiGate</em></li></ul><p>The <em>partner</em> requirement above is pretty standard. As organizations look to modernize using the <em>public cloud</em>, often, they will work with a <strong>preferred partner</strong> to give them a strong start and avoid mistakes in the beginning that would otherwise set them back. These <em>partners</em> generally have access to the environments in scope for modernization only.</p><div class="admonition danger"><p class=admonition-title>Why not forward everything to Firewalls?</p><p>It may be tempting to forward all traffic through <strong>NGFWs</strong>. Meeting compliance requirements, especially when <strong>protected data</strong> is involved, can be challenging. However, it does not make sense when examining cloud principles and cost. Identify traffic required to transit <em>firewalls</em> if possible for compliance or other meaningful reasons. If you have <em>sandbox</em> cloud networks that have no access to data or any other intellectual property, does it make sense to forward all that traffic through a <em>firewall</em>?</p></div><h2 id=lets-build>Let&rsquo;s Build!</h2><p>We could create separate <em>resource</em> blocks for each <strong>FortiGate</strong> we want to deploy, but that would be unsightly. For this example, let&rsquo;s use <a href=%5Bhttps://%5D(https://www.terraform.io/language/meta-arguments/count)>count</a> to create multiple services and <a href=https://www.terraform.io/language/expressions/dynamic-blocks>dynamic blocks</a> to handle the <em>nested schema</em> for <strong>instances</strong>.</p><h3 id=some-locals>Some Locals</h3><p>We need to deploy the service twice since we are working across <em>two regions</em>. Let&rsquo;s define names for the service, the regions we are deploying for, <em>instance</em> configurations for when <em>auto-scaling</em> occurs, and some values for policies. I have a separate <strong>variables.tf</strong> file with var type: <strong>list(map(string))</strong> that I have the instance <em>names</em> and <em>serials</em> defined in, so I&rsquo;m just looping through those here.</p><script type=application/javascript src=https://gist.github.com/wcollins/0fccbd10a41edfaafc263b1ce6d19b14.js></script><h3 id=fortinet-configuration>Fortinet Configuration</h3><p>Since we already have <em>segments</em> and <em>groups</em> provisioned, we can reference them in our <strong>main.tf</strong> file. This configuration will provision a <strong>Fortinet</strong> service per region, connect back to our <strong>FortiManager</strong> instance on-premises, map our existing <em>firewall</em> zones to Alkira <em>groups</em> for multi-cloud segmentation, and <em>auto-scale</em> to handle load elastically.</p><script type=application/javascript src=https://gist.github.com/wcollins/0783e0cd3283f7cb5c3841e755342148.js></script><h3 id=policy-configuration>Policy Configuration</h3><p>Now, we can selectively steer traffic to the <em>FortiGates</em>. <a href=https://registry.terraform.io/providers/alkiranet/alkira/latest/docs/resources/policy>Policy Resources</a> can take a <em>list of ids</em> for <em>source</em> and <em>destination</em> groups. This is why I defined the <strong>to_groups</strong> and <strong>from_groups</strong> in local variables. We can simply loop through each set, return the IDs, and provide them as a single value to the policy resource.</p><script type=application/javascript src=https://gist.github.com/wcollins/bda4d42b836a0fdd0109fbe09e243070.js></script><h2 id=validation>Validation</h2><p>Let&rsquo;s validate our policies to make sure they are meeting requirements. Alkira&rsquo;s ability to visualize policy comes in handy when reviewing multi-cloud policy, traffic flows, and network security more broadly. Having the ability to integrate this into the <strong>DevOps Toolchain</strong> makes for a great experience.</p><p><img src=/images/2022/terraforming-alkira-and-fortinet-is-multicloud-bliss/validate-policy.gif alt="Validate Policy"></p><h2 id=conclusion>Conclusion</h2><p>Ever heard of that <em>single</em> product that solved all your organization&rsquo;s network and security problems? Me neither! Valuable <em>integrations</em> like this one solve <strong>real</strong> problems. With the explosion of <strong>cloud services</strong>, it pays to zoom out and think about the <strong>long game</strong>. Building a strategy for your organization to support the <em>legacy applications</em> you can&rsquo;t migrate, the applications on deck for migration to the cloud, and <em>greenfield</em> applications across multiple clouds, is a winning strategy. <a href=https://alkira.com>Alkira</a> and <a href=https://fortinet.com>Fortinet</a> are two products that can help shift your focus to <em>outcomes</em>.</p></div><footer class=post-footer><div class=post-tags><a href=/tags/alkira/>alkira</a>
<a href=/tags/fortinet/>fortinet</a>
<a href=/tags/infrastructure-as-code/>infrastructure-as-code</a>
<a href=/tags/policy-as-code/>policy-as-code</a>
<a href=/tags/terraform/>terraform</a>
<a href=/tags/segmentation/>segmentation</a></div><nav class=post-nav><a class=prev href=/post/2022/the-best-terraform-feature-yet/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">The Best Terraform Feature Yet?</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/post/2022/aws-community-day-midwest/><span class="next-text nav-default">AWS Community Day - Midwest</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><script async src="https://www.googletagmanager.com/gtag/js?id=G-9QKVT40M3H"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9QKVT40M3H",{anonymize_ip:!1})}</script><footer id=footer class=footer><div class=social-links><a href=https://twitter.com/wcollins502/ class="iconfont icon-twitter" title=twitter></a>
<a href=https://www.linkedin.com/in/william-collins/ class="iconfont icon-linkedin" title=linkedin></a>
<a href=https://github.com/wcollins/ class="iconfont icon-github" title=github></a>
<a href=http://wcollins.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=copyright-year>&copy;
2020 -
2022<span class=division> |</span>
<span>William Collins</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.1c70606d1b733282f06230615f5561b5894924b6f9930ba2ab99cf1254f75a1a.js></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-9QKVT40M3H","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>